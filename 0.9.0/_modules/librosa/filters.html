<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>librosa.filters &mdash; librosa 0.9.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
            <a href="../../index.html">
            <img src="../../_static/librosa_logo_text.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.9.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../core.html">Core IO and DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../display.html">Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../feature.html">Feature extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../onset.html">Onset detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beat.html">Beat and tempo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../decompose.html">Spectrogram decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../effects.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../segment.html">Temporal segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sequence.html">Sequential modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../util.html">Utilities</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../multichannel.html">Multi-channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filters.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cache.html">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ioformats.html">Advanced I/O Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced.html">Advanced examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../recordings.html">Example files</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">librosa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>librosa.filters</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for librosa.filters</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Filters</span>
<span class="sd">=======</span>

<span class="sd">Filter bank construction</span>
<span class="sd">------------------------</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    mel</span>
<span class="sd">    chroma</span>
<span class="sd">    wavelet</span>
<span class="sd">    semitone_filterbank</span>

<span class="sd">Window functions</span>
<span class="sd">----------------</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    window_bandwidth</span>
<span class="sd">    get_window</span>

<span class="sd">Miscellaneous</span>
<span class="sd">-------------</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    wavelet_lengths</span>
<span class="sd">    cq_to_chroma</span>
<span class="sd">    mr_frequencies</span>
<span class="sd">    window_sumsquare</span>
<span class="sd">    diagonal_filter</span>

<span class="sd">Deprecated</span>
<span class="sd">----------</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    constant_q</span>
<span class="sd">    constant_q_lengths</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span>

<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span>

<span class="kn">from</span> <span class="nn">._cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">.util.exceptions</span> <span class="kn">import</span> <span class="n">ParameterError</span>
<span class="kn">from</span> <span class="nn">.util.decorators</span> <span class="kn">import</span> <span class="n">deprecated</span>

<span class="kn">from</span> <span class="nn">.core.convert</span> <span class="kn">import</span> <span class="n">note_to_hz</span><span class="p">,</span> <span class="n">hz_to_midi</span><span class="p">,</span> <span class="n">midi_to_hz</span><span class="p">,</span> <span class="n">hz_to_octs</span>
<span class="kn">from</span> <span class="nn">.core.convert</span> <span class="kn">import</span> <span class="n">fft_frequencies</span><span class="p">,</span> <span class="n">mel_frequencies</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;mel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;chroma&quot;</span><span class="p">,</span>
    <span class="s2">&quot;constant_q&quot;</span><span class="p">,</span>
    <span class="s2">&quot;constant_q_lengths&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cq_to_chroma&quot;</span><span class="p">,</span>
    <span class="s2">&quot;window_bandwidth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_window&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mr_frequencies&quot;</span><span class="p">,</span>
    <span class="s2">&quot;semitone_filterbank&quot;</span><span class="p">,</span>
    <span class="s2">&quot;window_sumsquare&quot;</span><span class="p">,</span>
    <span class="s2">&quot;diagonal_filter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wavelet&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wavelet_lengths&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Dictionary of window function bandwidths</span>

<span class="n">WINDOW_BANDWIDTHS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;bart&quot;</span><span class="p">:</span> <span class="mf">1.3334961334912805</span><span class="p">,</span>
    <span class="s2">&quot;barthann&quot;</span><span class="p">:</span> <span class="mf">1.4560255965133932</span><span class="p">,</span>
    <span class="s2">&quot;bartlett&quot;</span><span class="p">:</span> <span class="mf">1.3334961334912805</span><span class="p">,</span>
    <span class="s2">&quot;bkh&quot;</span><span class="p">:</span> <span class="mf">2.0045975283585014</span><span class="p">,</span>
    <span class="s2">&quot;black&quot;</span><span class="p">:</span> <span class="mf">1.7269681554262326</span><span class="p">,</span>
    <span class="s2">&quot;blackharr&quot;</span><span class="p">:</span> <span class="mf">2.0045975283585014</span><span class="p">,</span>
    <span class="s2">&quot;blackman&quot;</span><span class="p">:</span> <span class="mf">1.7269681554262326</span><span class="p">,</span>
    <span class="s2">&quot;blackmanharris&quot;</span><span class="p">:</span> <span class="mf">2.0045975283585014</span><span class="p">,</span>
    <span class="s2">&quot;blk&quot;</span><span class="p">:</span> <span class="mf">1.7269681554262326</span><span class="p">,</span>
    <span class="s2">&quot;bman&quot;</span><span class="p">:</span> <span class="mf">1.7859588613860062</span><span class="p">,</span>
    <span class="s2">&quot;bmn&quot;</span><span class="p">:</span> <span class="mf">1.7859588613860062</span><span class="p">,</span>
    <span class="s2">&quot;bohman&quot;</span><span class="p">:</span> <span class="mf">1.7859588613860062</span><span class="p">,</span>
    <span class="s2">&quot;box&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s2">&quot;boxcar&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s2">&quot;brt&quot;</span><span class="p">:</span> <span class="mf">1.3334961334912805</span><span class="p">,</span>
    <span class="s2">&quot;brthan&quot;</span><span class="p">:</span> <span class="mf">1.4560255965133932</span><span class="p">,</span>
    <span class="s2">&quot;bth&quot;</span><span class="p">:</span> <span class="mf">1.4560255965133932</span><span class="p">,</span>
    <span class="s2">&quot;cosine&quot;</span><span class="p">:</span> <span class="mf">1.2337005350199792</span><span class="p">,</span>
    <span class="s2">&quot;flat&quot;</span><span class="p">:</span> <span class="mf">2.7762255046484143</span><span class="p">,</span>
    <span class="s2">&quot;flattop&quot;</span><span class="p">:</span> <span class="mf">2.7762255046484143</span><span class="p">,</span>
    <span class="s2">&quot;flt&quot;</span><span class="p">:</span> <span class="mf">2.7762255046484143</span><span class="p">,</span>
    <span class="s2">&quot;halfcosine&quot;</span><span class="p">:</span> <span class="mf">1.2337005350199792</span><span class="p">,</span>
    <span class="s2">&quot;ham&quot;</span><span class="p">:</span> <span class="mf">1.3629455320350348</span><span class="p">,</span>
    <span class="s2">&quot;hamm&quot;</span><span class="p">:</span> <span class="mf">1.3629455320350348</span><span class="p">,</span>
    <span class="s2">&quot;hamming&quot;</span><span class="p">:</span> <span class="mf">1.3629455320350348</span><span class="p">,</span>
    <span class="s2">&quot;han&quot;</span><span class="p">:</span> <span class="mf">1.50018310546875</span><span class="p">,</span>
    <span class="s2">&quot;hann&quot;</span><span class="p">:</span> <span class="mf">1.50018310546875</span><span class="p">,</span>
    <span class="s2">&quot;hanning&quot;</span><span class="p">:</span> <span class="mf">1.50018310546875</span><span class="p">,</span>
    <span class="s2">&quot;nut&quot;</span><span class="p">:</span> <span class="mf">1.9763500280946082</span><span class="p">,</span>
    <span class="s2">&quot;nutl&quot;</span><span class="p">:</span> <span class="mf">1.9763500280946082</span><span class="p">,</span>
    <span class="s2">&quot;nuttall&quot;</span><span class="p">:</span> <span class="mf">1.9763500280946082</span><span class="p">,</span>
    <span class="s2">&quot;ones&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s2">&quot;par&quot;</span><span class="p">:</span> <span class="mf">1.9174603174603191</span><span class="p">,</span>
    <span class="s2">&quot;parz&quot;</span><span class="p">:</span> <span class="mf">1.9174603174603191</span><span class="p">,</span>
    <span class="s2">&quot;parzen&quot;</span><span class="p">:</span> <span class="mf">1.9174603174603191</span><span class="p">,</span>
    <span class="s2">&quot;rect&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s2">&quot;rectangular&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s2">&quot;tri&quot;</span><span class="p">:</span> <span class="mf">1.3331706523555851</span><span class="p">,</span>
    <span class="s2">&quot;triang&quot;</span><span class="p">:</span> <span class="mf">1.3331706523555851</span><span class="p">,</span>
    <span class="s2">&quot;triangle&quot;</span><span class="p">:</span> <span class="mf">1.3331706523555851</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="mel"><a class="viewcode-back" href="../../generated/librosa.filters.mel.html#librosa.filters.mel">[docs]</a><span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mel</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">sr</span><span class="p">,</span>
    <span class="n">n_fft</span><span class="p">,</span>
    <span class="n">n_mels</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">fmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">fmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">htk</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;slaney&quot;</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a Mel filter-bank.</span>

<span class="sd">    This produces a linear transformation matrix to project</span>
<span class="sd">    FFT bins onto Mel-frequency bins.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        sampling rate of the incoming signal</span>

<span class="sd">    n_fft : int &gt; 0 [scalar]</span>
<span class="sd">        number of FFT components</span>

<span class="sd">    n_mels : int &gt; 0 [scalar]</span>
<span class="sd">        number of Mel bands to generate</span>

<span class="sd">    fmin : float &gt;= 0 [scalar]</span>
<span class="sd">        lowest frequency (in Hz)</span>

<span class="sd">    fmax : float &gt;= 0 [scalar]</span>
<span class="sd">        highest frequency (in Hz).</span>
<span class="sd">        If `None`, use ``fmax = sr / 2.0``</span>

<span class="sd">    htk : bool [scalar]</span>
<span class="sd">        use HTK formula instead of Slaney</span>

<span class="sd">    norm : {None, &#39;slaney&#39;, or number} [scalar]</span>
<span class="sd">        If &#39;slaney&#39;, divide the triangular mel weights by the width of the mel band</span>
<span class="sd">        (area normalization).</span>

<span class="sd">        If numeric, use `librosa.util.normalize` to normalize each filter by to unit l_p norm.</span>
<span class="sd">        See `librosa.util.normalize` for a full description of supported norm values</span>
<span class="sd">        (including `+-np.inf`).</span>

<span class="sd">        Otherwise, leave all the triangles aiming for a peak value of 1.0</span>

<span class="sd">    dtype : np.dtype</span>
<span class="sd">        The data type of the output basis.</span>
<span class="sd">        By default, uses 32-bit (single-precision) floating point.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    M : np.ndarray [shape=(n_mels, 1 + n_fft/2)]</span>
<span class="sd">        Mel transform matrix</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    librosa.util.normalize</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; melfb = librosa.filters.mel(sr=22050, n_fft=2048)</span>
<span class="sd">    &gt;&gt;&gt; melfb</span>
<span class="sd">    array([[ 0.   ,  0.016, ...,  0.   ,  0.   ],</span>
<span class="sd">           [ 0.   ,  0.   , ...,  0.   ,  0.   ],</span>
<span class="sd">           ...,</span>
<span class="sd">           [ 0.   ,  0.   , ...,  0.   ,  0.   ],</span>
<span class="sd">           [ 0.   ,  0.   , ...,  0.   ,  0.   ]])</span>

<span class="sd">    Clip the maximum frequency to 8KHz</span>

<span class="sd">    &gt;&gt;&gt; librosa.filters.mel(sr=22050, n_fft=2048, fmax=8000)</span>
<span class="sd">    array([[ 0.  ,  0.02, ...,  0.  ,  0.  ],</span>
<span class="sd">           [ 0.  ,  0.  , ...,  0.  ,  0.  ],</span>
<span class="sd">           ...,</span>
<span class="sd">           [ 0.  ,  0.  , ...,  0.  ,  0.  ],</span>
<span class="sd">           [ 0.  ,  0.  , ...,  0.  ,  0.  ]])</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; img = librosa.display.specshow(melfb, x_axis=&#39;linear&#39;, ax=ax)</span>
<span class="sd">    &gt;&gt;&gt; ax.set(ylabel=&#39;Mel filter&#39;, title=&#39;Mel filter bank&#39;)</span>
<span class="sd">    &gt;&gt;&gt; fig.colorbar(img, ax=ax)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">fmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Initialize the weights</span>
    <span class="n">n_mels</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_mels</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_mels</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">n_fft</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

    <span class="c1"># Center freqs of each FFT bin</span>
    <span class="n">fftfreqs</span> <span class="o">=</span> <span class="n">fft_frequencies</span><span class="p">(</span><span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="n">n_fft</span><span class="p">)</span>

    <span class="c1"># &#39;Center freqs&#39; of mel bands - uniformly spaced between limits</span>
    <span class="n">mel_f</span> <span class="o">=</span> <span class="n">mel_frequencies</span><span class="p">(</span><span class="n">n_mels</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span> <span class="n">htk</span><span class="o">=</span><span class="n">htk</span><span class="p">)</span>

    <span class="n">fdiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">mel_f</span><span class="p">)</span>
    <span class="n">ramps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">mel_f</span><span class="p">,</span> <span class="n">fftfreqs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mels</span><span class="p">):</span>
        <span class="c1"># lower and upper slopes for all bins</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="o">-</span><span class="n">ramps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">fdiff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">ramps</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">fdiff</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># .. then intersect them with each other and zero</span>
        <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s2">&quot;slaney&quot;</span><span class="p">:</span>
        <span class="c1"># Slaney-style mel is scaled to be approx constant energy per channel</span>
        <span class="n">enorm</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">mel_f</span><span class="p">[</span><span class="mi">2</span> <span class="p">:</span> <span class="n">n_mels</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">mel_f</span><span class="p">[:</span><span class="n">n_mels</span><span class="p">])</span>
        <span class="n">weights</span> <span class="o">*=</span> <span class="n">enorm</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Only check weights if f_mel[0] is positive</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">mel_f</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="c1"># This means we have an empty channel somewhere</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Empty filters detected in mel frequency basis. &quot;</span>
            <span class="s2">&quot;Some channels will produce empty responses. &quot;</span>
            <span class="s2">&quot;Try increasing your sampling rate (and fmax) or &quot;</span>
            <span class="s2">&quot;reducing n_mels.&quot;</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">weights</span></div>


<div class="viewcode-block" id="chroma"><a class="viewcode-back" href="../../generated/librosa.filters.chroma.html#librosa.filters.chroma">[docs]</a><span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">chroma</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">sr</span><span class="p">,</span>
    <span class="n">n_fft</span><span class="p">,</span>
    <span class="n">n_chroma</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">tuning</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">ctroct</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
    <span class="n">octwidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">base_c</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a chroma filter bank.</span>

<span class="sd">    This creates a linear transformation matrix to project</span>
<span class="sd">    FFT bins onto chroma bins (i.e. pitch classes).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        audio sampling rate</span>

<span class="sd">    n_fft : int &gt; 0 [scalar]</span>
<span class="sd">        number of FFT bins</span>

<span class="sd">    n_chroma : int &gt; 0 [scalar]</span>
<span class="sd">        number of chroma bins</span>

<span class="sd">    tuning : float</span>
<span class="sd">        Tuning deviation from A440 in fractions of a chroma bin.</span>

<span class="sd">    ctroct : float &gt; 0 [scalar]</span>

<span class="sd">    octwidth : float &gt; 0 or None [scalar]</span>
<span class="sd">        ``ctroct`` and ``octwidth`` specify a dominance window:</span>
<span class="sd">        a Gaussian weighting centered on ``ctroct`` (in octs, A0 = 27.5Hz)</span>
<span class="sd">        and with a gaussian half-width of ``octwidth``.</span>

<span class="sd">        Set ``octwidth`` to `None` to use a flat weighting.</span>

<span class="sd">    norm : float &gt; 0 or np.inf</span>
<span class="sd">        Normalization factor for each filter</span>

<span class="sd">    base_c : bool</span>
<span class="sd">        If True, the filter bank will start at &#39;C&#39;.</span>
<span class="sd">        If False, the filter bank will start at &#39;A&#39;.</span>

<span class="sd">    dtype : np.dtype</span>
<span class="sd">        The data type of the output basis.</span>
<span class="sd">        By default, uses 32-bit (single-precision) floating point.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    wts : ndarray [shape=(n_chroma, 1 + n_fft / 2)]</span>
<span class="sd">        Chroma filter matrix</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    librosa.util.normalize</span>
<span class="sd">    librosa.feature.chroma_stft</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Build a simple chroma filter bank</span>

<span class="sd">    &gt;&gt;&gt; chromafb = librosa.filters.chroma(sr=22050, n_fft=4096)</span>
<span class="sd">    array([[  1.689e-05,   3.024e-04, ...,   4.639e-17,   5.327e-17],</span>
<span class="sd">           [  1.716e-05,   2.652e-04, ...,   2.674e-25,   3.176e-25],</span>
<span class="sd">    ...,</span>
<span class="sd">           [  1.578e-05,   3.619e-04, ...,   8.577e-06,   9.205e-06],</span>
<span class="sd">           [  1.643e-05,   3.355e-04, ...,   1.474e-10,   1.636e-10]])</span>

<span class="sd">    Use quarter-tones instead of semitones</span>

<span class="sd">    &gt;&gt;&gt; librosa.filters.chroma(sr=22050, n_fft=4096, n_chroma=24)</span>
<span class="sd">    array([[  1.194e-05,   2.138e-04, ...,   6.297e-64,   1.115e-63],</span>
<span class="sd">           [  1.206e-05,   2.009e-04, ...,   1.546e-79,   2.929e-79],</span>
<span class="sd">    ...,</span>
<span class="sd">           [  1.162e-05,   2.372e-04, ...,   6.417e-38,   9.923e-38],</span>
<span class="sd">           [  1.180e-05,   2.260e-04, ...,   4.697e-50,   7.772e-50]])</span>

<span class="sd">    Equally weight all octaves</span>

<span class="sd">    &gt;&gt;&gt; librosa.filters.chroma(sr=22050, n_fft=4096, octwidth=None)</span>
<span class="sd">    array([[  3.036e-01,   2.604e-01, ...,   2.445e-16,   2.809e-16],</span>
<span class="sd">           [  3.084e-01,   2.283e-01, ...,   1.409e-24,   1.675e-24],</span>
<span class="sd">    ...,</span>
<span class="sd">           [  2.836e-01,   3.116e-01, ...,   4.520e-05,   4.854e-05],</span>
<span class="sd">           [  2.953e-01,   2.888e-01, ...,   7.768e-10,   8.629e-10]])</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; img = librosa.display.specshow(chromafb, x_axis=&#39;linear&#39;, ax=ax)</span>
<span class="sd">    &gt;&gt;&gt; ax.set(ylabel=&#39;Chroma filter&#39;, title=&#39;Chroma filter bank&#39;)</span>
<span class="sd">    &gt;&gt;&gt; fig.colorbar(img, ax=ax)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_chroma</span><span class="p">,</span> <span class="n">n_fft</span><span class="p">))</span>

    <span class="c1"># Get the FFT bins, not counting the DC component</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">n_fft</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">frqbins</span> <span class="o">=</span> <span class="n">n_chroma</span> <span class="o">*</span> <span class="n">hz_to_octs</span><span class="p">(</span>
        <span class="n">frequencies</span><span class="p">,</span> <span class="n">tuning</span><span class="o">=</span><span class="n">tuning</span><span class="p">,</span> <span class="n">bins_per_octave</span><span class="o">=</span><span class="n">n_chroma</span>
    <span class="p">)</span>

    <span class="c1"># make up a value for the 0 Hz bin = 1.5 octaves below bin 1</span>
    <span class="c1"># (so chroma is 50% rotated from bin 1, and bin width is broad)</span>
    <span class="n">frqbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="n">frqbins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">n_chroma</span><span class="p">],</span> <span class="n">frqbins</span><span class="p">))</span>

    <span class="n">binwidthbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">frqbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">frqbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">frqbins</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_chroma</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

    <span class="n">n_chroma2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">n_chroma</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Project into range -n_chroma/2 .. n_chroma/2</span>
    <span class="c1"># add on fixed offset of 10*n_chroma to ensure all values passed to</span>
    <span class="c1"># rem are positive</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="n">n_chroma2</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">n_chroma</span><span class="p">,</span> <span class="n">n_chroma</span><span class="p">)</span> <span class="o">-</span> <span class="n">n_chroma2</span>

    <span class="c1"># Gaussian bumps - 2*D to make them narrower</span>
    <span class="n">wts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">D</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">binwidthbins</span><span class="p">,</span> <span class="p">(</span><span class="n">n_chroma</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># normalize each column</span>
    <span class="n">wts</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">wts</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Maybe apply scaling for fft bins</span>
    <span class="k">if</span> <span class="n">octwidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wts</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(((</span><span class="n">frqbins</span> <span class="o">/</span> <span class="n">n_chroma</span> <span class="o">-</span> <span class="n">ctroct</span><span class="p">)</span> <span class="o">/</span> <span class="n">octwidth</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">n_chroma</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">base_c</span><span class="p">:</span>
        <span class="n">wts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">wts</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_chroma</span> <span class="o">//</span> <span class="mi">12</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># remove aliasing columns, copy to ensure row-contiguity</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">wts</span><span class="p">[:,</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">n_fft</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">__float_window</span><span class="p">(</span><span class="n">window_spec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator function for windows with fractional input.</span>

<span class="sd">    This function guarantees that for fractional ``x``, the following hold:</span>

<span class="sd">    1. ``__float_window(window_function)(x)`` has length ``np.ceil(x)``</span>
<span class="sd">    2. all values from ``np.floor(x)`` are set to 0.</span>

<span class="sd">    For integer-valued ``x``, there should be no change in behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_wrap</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The wrapped window&quot;&quot;&quot;</span>
        <span class="n">n_min</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

        <span class="n">window</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="n">window_spec</span><span class="p">,</span> <span class="n">n_min</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_max</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">))],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">)</span>

        <span class="n">window</span><span class="p">[</span><span class="n">n_min</span><span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">window</span>

    <span class="k">return</span> <span class="n">_wrap</span>


<div class="viewcode-block" id="constant_q"><a class="viewcode-back" href="../../generated/librosa.filters.constant_q.html#librosa.filters.constant_q">[docs]</a><span class="nd">@deprecated</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s2">&quot;0.9.0&quot;</span><span class="p">,</span> <span class="n">version_removed</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">constant_q</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">sr</span><span class="p">,</span>
    <span class="n">fmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">n_bins</span><span class="o">=</span><span class="mi">84</span><span class="p">,</span>
    <span class="n">bins_per_octave</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">window</span><span class="o">=</span><span class="s2">&quot;hann&quot;</span><span class="p">,</span>
    <span class="n">filter_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">pad_fft</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
    <span class="n">gamma</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct a constant-Q basis.</span>

<span class="sd">    This function constructs a filter bank similar to Morlet wavelets,</span>
<span class="sd">    where complex exponentials are windowed to different lengths</span>
<span class="sd">    such that the number of cycles remains fixed for all frequencies.</span>

<span class="sd">    By default, a Hann window (rather than the Gaussian window of Morlet wavelets)</span>
<span class="sd">    is used, but this can be controlled by the ``window`` parameter.</span>

<span class="sd">    Frequencies are spaced geometrically, increasing by a factor of</span>
<span class="sd">    ``(2**(1./bins_per_octave))`` at each successive band.</span>

<span class="sd">    .. warning:: This function is deprecated as of v0.9 and will be removed in 1.0.</span>
<span class="sd">        See `librosa.filters.wavelet`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        Audio sampling rate</span>

<span class="sd">    fmin : float &gt; 0 [scalar]</span>
<span class="sd">        Minimum frequency bin. Defaults to `C1 ~= 32.70`</span>

<span class="sd">    n_bins : int &gt; 0 [scalar]</span>
<span class="sd">        Number of frequencies.  Defaults to 7 octaves (84 bins).</span>

<span class="sd">    bins_per_octave : int &gt; 0 [scalar]</span>
<span class="sd">        Number of bins per octave</span>

<span class="sd">    window : string, tuple, number, or function</span>
<span class="sd">        Windowing function to apply to filters.</span>

<span class="sd">    filter_scale : float &gt; 0 [scalar]</span>
<span class="sd">        Scale of filter windows.</span>
<span class="sd">        Small values (&lt;1) use shorter windows for higher temporal resolution.</span>

<span class="sd">    pad_fft : boolean</span>
<span class="sd">        Center-pad all filters up to the nearest integral power of 2.</span>

<span class="sd">        By default, padding is done with zeros, but this can be overridden</span>
<span class="sd">        by setting the ``mode=`` field in *kwargs*.</span>

<span class="sd">    norm : {inf, -inf, 0, float &gt; 0}</span>
<span class="sd">        Type of norm to use for basis function normalization.</span>
<span class="sd">        See librosa.util.normalize</span>

<span class="sd">    gamma : number &gt;= 0</span>
<span class="sd">        Bandwidth offset for variable-Q transforms.</span>
<span class="sd">        ``gamma=0`` produces a constant-Q filterbank.</span>

<span class="sd">    dtype : np.dtype</span>
<span class="sd">        The data type of the output basis.</span>
<span class="sd">        By default, uses 64-bit (single precision) complex floating point.</span>

<span class="sd">    **kwargs : additional keyword arguments</span>
<span class="sd">        Arguments to `np.pad()` when ``pad==True``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filters : np.ndarray, ``len(filters) == n_bins``</span>
<span class="sd">        ``filters[i]`` is ``i``\ th time-domain CQT basis filter</span>
<span class="sd">    lengths : np.ndarray, ``len(lengths) == n_bins``</span>
<span class="sd">        The (fractional) length of each filter</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    wavelet</span>
<span class="sd">    constant_q_lengths</span>
<span class="sd">    librosa.cqt</span>
<span class="sd">    librosa.vqt</span>
<span class="sd">    librosa.util.normalize</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Use a shorter window for each filter</span>

<span class="sd">    &gt;&gt;&gt; basis, lengths = librosa.filters.constant_q(sr=22050, filter_scale=0.5)</span>

<span class="sd">    Plot one octave of filters in time and frequency</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; basis, lengths = librosa.filters.constant_q(sr=22050)</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=2, figsize=(10, 6))</span>
<span class="sd">    &gt;&gt;&gt; notes = librosa.midi_to_note(np.arange(24, 24 + len(basis)))</span>
<span class="sd">    &gt;&gt;&gt; for i, (f, n) in enumerate(zip(basis, notes[:12])):</span>
<span class="sd">    ...     f_scale = librosa.util.normalize(f) / 2</span>
<span class="sd">    ...     ax[0].plot(i + f_scale.real)</span>
<span class="sd">    ...     ax[0].plot(i + f_scale.imag, linestyle=&#39;:&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].set(yticks=np.arange(len(notes[:12])), yticklabels=notes[:12],</span>
<span class="sd">    ...           ylabel=&#39;CQ filters&#39;,</span>
<span class="sd">    ...           title=&#39;CQ filters (one octave, time domain)&#39;,</span>
<span class="sd">    ...           xlabel=&#39;Time (samples at 22050 Hz)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].legend([&#39;Real&#39;, &#39;Imaginary&#39;])</span>
<span class="sd">    &gt;&gt;&gt; F = np.abs(np.fft.fftn(basis, axes=[-1]))</span>
<span class="sd">    &gt;&gt;&gt; # Keep only the positive frequencies</span>
<span class="sd">    &gt;&gt;&gt; F = F[:, :(1 + F.shape[1] // 2)]</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(F, x_axis=&#39;linear&#39;, y_axis=&#39;cqt_note&#39;, ax=ax[1])</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(ylabel=&#39;CQ filters&#39;, title=&#39;CQ filter magnitudes (frequency domain)&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">fmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="n">note_to_hz</span><span class="p">(</span><span class="s2">&quot;C1&quot;</span><span class="p">)</span>

    <span class="c1"># Pass-through parameters to get the filter lengths</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="n">constant_q_lengths</span><span class="p">(</span>
        <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
        <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span>
        <span class="n">n_bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span>
        <span class="n">bins_per_octave</span><span class="o">=</span><span class="n">bins_per_octave</span><span class="p">,</span>
        <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span>
        <span class="n">filter_scale</span><span class="o">=</span><span class="n">filter_scale</span><span class="p">,</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">freqs</span> <span class="o">=</span> <span class="n">fmin</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">))</span>

    <span class="c1"># Build the filters</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ilen</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">freqs</span><span class="p">):</span>
        <span class="c1"># Build the filter: note, length will be ceil(ilen)</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">ilen</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ilen</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">/</span> <span class="n">sr</span>
        <span class="p">)</span>

        <span class="c1"># Apply the windowing function</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">__float_window</span><span class="p">(</span><span class="n">window</span><span class="p">)(</span><span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">))</span>

        <span class="c1"># Normalize</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>

    <span class="c1"># Pad and stack</span>
    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pad_fft</span><span class="p">:</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">max_len</span><span class="p">))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">max_len</span><span class="p">))</span>

    <span class="n">filters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">pad_center</span><span class="p">(</span><span class="n">filt</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">max_len</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">filt</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">filters</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span></div>


<div class="viewcode-block" id="constant_q_lengths"><a class="viewcode-back" href="../../generated/librosa.filters.constant_q_lengths.html#librosa.filters.constant_q_lengths">[docs]</a><span class="nd">@deprecated</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s2">&quot;0.9.0&quot;</span><span class="p">,</span> <span class="n">version_removed</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="p">)</span>
<span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">constant_q_lengths</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">84</span><span class="p">,</span> <span class="n">bins_per_octave</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s2">&quot;hann&quot;</span><span class="p">,</span> <span class="n">filter_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">0</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return length of each filter in a constant-Q basis.</span>

<span class="sd">    .. warning:: This function is deprecated as of v0.9 and will be removed in 1.0.</span>
<span class="sd">        See `librosa.filters.wavelet_lengths`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        Audio sampling rate</span>
<span class="sd">    fmin : float &gt; 0 [scalar]</span>
<span class="sd">        Minimum frequency bin.</span>
<span class="sd">    n_bins : int &gt; 0 [scalar]</span>
<span class="sd">        Number of frequencies.  Defaults to 7 octaves (84 bins).</span>
<span class="sd">    bins_per_octave : int &gt; 0 [scalar]</span>
<span class="sd">        Number of bins per octave</span>
<span class="sd">    window : str or callable</span>
<span class="sd">        Window function to use on filters</span>
<span class="sd">    filter_scale : float &gt; 0 [scalar]</span>
<span class="sd">        Resolution of filter windows. Larger values use longer windows.</span>
<span class="sd">    gamma : number &gt;= 0</span>
<span class="sd">        Bandwidth offset for variable-Q transforms.</span>
<span class="sd">        ``gamma=0`` produces a constant-Q filterbank.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lengths : np.ndarray</span>
<span class="sd">        The length of each filter.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    wavelet_lengths</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">fmin</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;fmin must be strictly positive&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">bins_per_octave</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;bins_per_octave must be positive&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filter_scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;filter_scale must be positive&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_bins</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_bins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;n_bins must be a positive integer&quot;</span><span class="p">)</span>

    <span class="c1"># Compute the frequencies</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">fmin</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">))</span>

    <span class="c1"># Q should be capitalized here, so we suppress the name warning</span>
    <span class="c1"># pylint: disable=invalid-name</span>
    <span class="c1">#</span>
    <span class="c1"># Balance filter bandwidths</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">filter_scale</span><span class="p">)</span> <span class="o">/</span> <span class="n">alpha</span>

    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">freq</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">window_bandwidth</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">/</span> <span class="n">Q</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">sr</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Maximum filter frequency=</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> would exceed Nyquist=</span><span class="si">{</span><span class="n">sr</span><span class="o">/</span><span class="mi">2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Convert frequencies to filter lengths</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">*</span> <span class="n">sr</span> <span class="o">/</span> <span class="p">(</span><span class="n">freq</span> <span class="o">+</span> <span class="n">gamma</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lengths</span></div>


<div class="viewcode-block" id="wavelet_lengths"><a class="viewcode-back" href="../../generated/librosa.filters.wavelet_lengths.html#librosa.filters.wavelet_lengths">[docs]</a><span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">wavelet_lengths</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s2">&quot;hann&quot;</span><span class="p">,</span> <span class="n">filter_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return length of each filter in a wavelet basis.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    freqs : np.ndarray (positive)</span>
<span class="sd">        Center frequencies of the filters (in Hz).</span>
<span class="sd">        Must be in ascending order.</span>

<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        Audio sampling rate</span>

<span class="sd">    window : str or callable</span>
<span class="sd">        Window function to use on filters</span>

<span class="sd">    filter_scale : float &gt; 0 [scalar]</span>
<span class="sd">        Resolution of filter windows. Larger values use longer windows.</span>

<span class="sd">    gamma : number &gt;= 0 [scalar, optional]</span>
<span class="sd">        Bandwidth offset for determining filter lengths, as used in</span>
<span class="sd">        Variable-Q transforms.</span>

<span class="sd">        Bandwidth for the k&#39;th filter is determined by::</span>

<span class="sd">            B[k] = alpha[k] * freqs[k] + gamma</span>

<span class="sd">        ``alpha[k]`` is twice the relative difference between ``freqs[k+1]`` and ``freqs[k-1]``::</span>

<span class="sd">            alpha[k] = (freqs[k+1]-freqs[k-1]) / (freqs[k+1]+freqs[k-1])</span>

<span class="sd">        If ``freqs`` follows a geometric progression (as in CQT and VQT), the vector</span>
<span class="sd">        ``alpha`` is constant and such that::</span>

<span class="sd">            (1 + alpha) * freqs[k-1] = (1 - alpha) * freqs[k+1]</span>

<span class="sd">        Furthermore, if ``gamma=0`` (default), ``alpha`` is such that even-``k`` and</span>
<span class="sd">        odd-``k`` filters are interleaved::</span>

<span class="sd">            freqs[k-1] + B[k-1] = freqs[k+1] - B[k+1]</span>

<span class="sd">        If ``gamma=None`` is specified, then ``gamma`` is computed such</span>
<span class="sd">        that each filter has bandwidth proportional to the equivalent</span>
<span class="sd">        rectangular bandwidth (ERB) at frequency ``freqs[k]``::</span>

<span class="sd">            gamma[k] = 24.7 * alpha[k] / 0.108</span>

<span class="sd">        as derived by [#]_.</span>

<span class="sd">        .. [#] Glasberg, Brian R., and Brian CJ Moore.</span>
<span class="sd">            &quot;Derivation of auditory filter shapes from notched-noise data.&quot;</span>
<span class="sd">            Hearing research 47.1-2 (1990): 103-138.</span>

<span class="sd">    alpha : number &gt; 0 [optional]</span>
<span class="sd">        If only one frequency is provided (``len(freqs)==1``), then filter bandwidth</span>
<span class="sd">        cannot be computed.  In that case, the ``alpha`` parameter described above</span>
<span class="sd">        can be explicitly specified here.</span>

<span class="sd">        If two or more frequencies are provided, this parameter is ignored.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lengths : np.ndarray</span>
<span class="sd">        The length of each filter.</span>
<span class="sd">    f_cutoff : float</span>
<span class="sd">        The lowest frequency at which all filters&#39; main lobes have decayed by</span>
<span class="sd">        at least 3dB.</span>

<span class="sd">        This second output serves in cqt and vqt to ensure that all wavelet</span>
<span class="sd">        bands remain below the Nyquist frequency.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ParameterError</span>
<span class="sd">        - If ``filter_scale`` is not strictly positive</span>

<span class="sd">        - If ``gamma`` is a negative number</span>

<span class="sd">        - If any frequencies are &lt;= 0</span>

<span class="sd">        - If the frequency array is not sorted in ascending order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filter_scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;filter_scale=</span><span class="si">{</span><span class="n">filter_scale</span><span class="si">}</span><span class="s2"> must be positive&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">gamma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gamma</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gamma=</span><span class="si">{</span><span class="n">gamma</span><span class="si">}</span><span class="s2"> must be non-negative&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">freqs</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;frequencies must be strictly positive&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">freqs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">freqs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Frequency array=</span><span class="si">{</span><span class="n">freqs</span><span class="si">}</span><span class="s2"> must be in strictly ascending order&quot;</span>
        <span class="p">)</span>

    <span class="c1"># We need at least 2 frequencies to infer alpha</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Approximate the local octave resolution</span>
        <span class="n">bpo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">))</span>
        <span class="n">logf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span>
        <span class="n">bpo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">logf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">logf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">bpo</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">logf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">logf</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">bpo</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">logf</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">logf</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">bpo</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">bpo</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot construct a wavelet basis for a single frequency if alpha is not provided&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">gamma</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mf">24.7</span> <span class="o">/</span> <span class="mf">0.108</span>

    <span class="c1"># Q should be capitalized here, so we suppress the name warning</span>
    <span class="c1"># pylint: disable=invalid-name</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">filter_scale</span><span class="p">)</span> <span class="o">/</span> <span class="n">alpha</span>

    <span class="c1"># How far up does our highest frequency reach?</span>
    <span class="n">f_cutoff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">freqs</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">window_bandwidth</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">/</span> <span class="n">Q</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">)</span>

    <span class="c1"># Convert frequencies to filter lengths</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">*</span> <span class="n">sr</span> <span class="o">/</span> <span class="p">(</span><span class="n">freqs</span> <span class="o">+</span> <span class="n">gamma</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">f_cutoff</span></div>


<div class="viewcode-block" id="wavelet"><a class="viewcode-back" href="../../generated/librosa.filters.wavelet.html#librosa.filters.wavelet">[docs]</a><span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">wavelet</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">freqs</span><span class="p">,</span>
    <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span>
    <span class="n">window</span><span class="o">=</span><span class="s2">&quot;hann&quot;</span><span class="p">,</span>
    <span class="n">filter_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">pad_fft</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
    <span class="n">gamma</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Construct a wavelet basis using windowed complex sinusoids.</span>

<span class="sd">    This function constructs a wavelet filterbank at a specified set of center</span>
<span class="sd">    frequencies.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    freqs : np.ndarray (positive)</span>
<span class="sd">        Center frequencies of the filters (in Hz).</span>
<span class="sd">        Must be in ascending order.</span>

<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        Audio sampling rate</span>

<span class="sd">    window : string, tuple, number, or function</span>
<span class="sd">        Windowing function to apply to filters.</span>

<span class="sd">    filter_scale : float &gt; 0 [scalar]</span>
<span class="sd">        Scale of filter windows.</span>
<span class="sd">        Small values (&lt;1) use shorter windows for higher temporal resolution.</span>

<span class="sd">    pad_fft : boolean</span>
<span class="sd">        Center-pad all filters up to the nearest integral power of 2.</span>

<span class="sd">        By default, padding is done with zeros, but this can be overridden</span>
<span class="sd">        by setting the ``mode=`` field in *kwargs*.</span>

<span class="sd">    norm : {inf, -inf, 0, float &gt; 0}</span>
<span class="sd">        Type of norm to use for basis function normalization.</span>
<span class="sd">        See librosa.util.normalize</span>

<span class="sd">    gamma : number &gt;= 0</span>
<span class="sd">        Bandwidth offset for variable-Q transforms.</span>

<span class="sd">    dtype : np.dtype</span>
<span class="sd">        The data type of the output basis.</span>
<span class="sd">        By default, uses 64-bit (single precision) complex floating point.</span>

<span class="sd">    alpha : number &gt; 0 [optional]</span>
<span class="sd">        If only one frequency is provided (``len(freqs)==1``), then filter bandwidth</span>
<span class="sd">        cannot be computed.  In that case, the ``alpha`` parameter described above</span>
<span class="sd">        can be explicitly specified here.</span>

<span class="sd">        If two or more frequencies are provided, this parameter is ignored.</span>

<span class="sd">    **kwargs : additional keyword arguments</span>
<span class="sd">        Arguments to `np.pad()` when ``pad==True``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filters : np.ndarray, ``len(filters) == n_bins``</span>
<span class="sd">        each ``filters[i]`` is a (complex) time-domain filter</span>
<span class="sd">    lengths : np.ndarray, ``len(lengths) == n_bins``</span>
<span class="sd">        The (fractional) length of each filter in samples</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    wavelet_lengths</span>
<span class="sd">    librosa.cqt</span>
<span class="sd">    librosa.vqt</span>
<span class="sd">    librosa.util.normalize</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Create a constant-Q basis</span>

<span class="sd">    &gt;&gt;&gt; freqs = librosa.cqt_frequencies(n_bins=84, fmin=librosa.note_to_hz(&#39;C1&#39;))</span>
<span class="sd">    &gt;&gt;&gt; basis, lengths = librosa.filters.wavelet(freqs=freqs, sr=22050)</span>

<span class="sd">    Plot one octave of filters in time and frequency</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; basis, lengths = librosa.filters.wavelet(freqs=freqs, sr=22050)</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=2, figsize=(10, 6))</span>
<span class="sd">    &gt;&gt;&gt; notes = librosa.midi_to_note(np.arange(24, 24 + len(basis)))</span>
<span class="sd">    &gt;&gt;&gt; for i, (f, n) in enumerate(zip(basis, notes[:12])):</span>
<span class="sd">    ...     f_scale = librosa.util.normalize(f) / 2</span>
<span class="sd">    ...     ax[0].plot(i + f_scale.real)</span>
<span class="sd">    ...     ax[0].plot(i + f_scale.imag, linestyle=&#39;:&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].set(yticks=np.arange(len(notes[:12])), yticklabels=notes[:12],</span>
<span class="sd">    ...           ylabel=&#39;CQ filters&#39;,</span>
<span class="sd">    ...           title=&#39;CQ filters (one octave, time domain)&#39;,</span>
<span class="sd">    ...           xlabel=&#39;Time (samples at 22050 Hz)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].legend([&#39;Real&#39;, &#39;Imaginary&#39;])</span>
<span class="sd">    &gt;&gt;&gt; F = np.abs(np.fft.fftn(basis, axes=[-1]))</span>
<span class="sd">    &gt;&gt;&gt; # Keep only the positive frequencies</span>
<span class="sd">    &gt;&gt;&gt; F = F[:, :(1 + F.shape[1] // 2)]</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(F, x_axis=&#39;linear&#39;, y_axis=&#39;cqt_note&#39;, ax=ax[1])</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(ylabel=&#39;CQ filters&#39;, title=&#39;CQ filter magnitudes (frequency domain)&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Pass-through parameters to get the filter lengths</span>
    <span class="n">lengths</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">wavelet_lengths</span><span class="p">(</span>
        <span class="n">freqs</span><span class="o">=</span><span class="n">freqs</span><span class="p">,</span>
        <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
        <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span>
        <span class="n">filter_scale</span><span class="o">=</span><span class="n">filter_scale</span><span class="p">,</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Build the filters</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ilen</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">freqs</span><span class="p">):</span>
        <span class="c1"># Build the filter: note, length will be ceil(ilen)</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">ilen</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ilen</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">/</span> <span class="n">sr</span>
        <span class="p">)</span>

        <span class="c1"># Apply the windowing function</span>
        <span class="n">sig</span> <span class="o">*=</span> <span class="n">__float_window</span><span class="p">(</span><span class="n">window</span><span class="p">)(</span><span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">))</span>

        <span class="c1"># Normalize</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>

    <span class="c1"># Pad and stack</span>
    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pad_fft</span><span class="p">:</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">max_len</span><span class="p">))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">max_len</span><span class="p">))</span>

    <span class="n">filters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">pad_center</span><span class="p">(</span><span class="n">filt</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">max_len</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">filt</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">filters</span><span class="p">,</span> <span class="n">lengths</span></div>


<div class="viewcode-block" id="cq_to_chroma"><a class="viewcode-back" href="../../generated/librosa.filters.cq_to_chroma.html#librosa.filters.cq_to_chroma">[docs]</a><span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cq_to_chroma</span><span class="p">(</span>
    <span class="n">n_input</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">bins_per_octave</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">n_chroma</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">fmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">base_c</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Construct a linear transformation matrix to map Constant-Q bins</span>
<span class="sd">    onto chroma bins (i.e., pitch classes).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_input : int &gt; 0 [scalar]</span>
<span class="sd">        Number of input components (CQT bins)</span>
<span class="sd">    bins_per_octave : int &gt; 0 [scalar]</span>
<span class="sd">        How many bins per octave in the CQT</span>
<span class="sd">    n_chroma : int &gt; 0 [scalar]</span>
<span class="sd">        Number of output bins (per octave) in the chroma</span>
<span class="sd">    fmin : None or float &gt; 0</span>
<span class="sd">        Center frequency of the first constant-Q channel.</span>
<span class="sd">        Default: &#39;C1&#39; ~= 32.7 Hz</span>
<span class="sd">    window : None or np.ndarray</span>
<span class="sd">        If provided, the cq_to_chroma filter bank will be</span>
<span class="sd">        convolved with ``window``.</span>
<span class="sd">    base_c : bool</span>
<span class="sd">        If True, the first chroma bin will start at &#39;C&#39;</span>
<span class="sd">        If False, the first chroma bin will start at &#39;A&#39;</span>
<span class="sd">    dtype : np.dtype</span>
<span class="sd">        The data type of the output basis.</span>
<span class="sd">        By default, uses 32-bit (single-precision) floating point.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cq_to_chroma : np.ndarray [shape=(n_chroma, n_input)]</span>
<span class="sd">        Transformation matrix: ``Chroma = np.dot(cq_to_chroma, CQT)``</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ParameterError</span>
<span class="sd">        If ``n_input`` is not an integer multiple of ``n_chroma``</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Get a CQT, and wrap bins to chroma</span>

<span class="sd">    &gt;&gt;&gt; y, sr = librosa.load(librosa.ex(&#39;trumpet&#39;))</span>
<span class="sd">    &gt;&gt;&gt; CQT = np.abs(librosa.cqt(y, sr=sr))</span>
<span class="sd">    &gt;&gt;&gt; chroma_map = librosa.filters.cq_to_chroma(CQT.shape[0])</span>
<span class="sd">    &gt;&gt;&gt; chromagram = chroma_map.dot(CQT)</span>
<span class="sd">    &gt;&gt;&gt; # Max-normalize each time step</span>
<span class="sd">    &gt;&gt;&gt; chromagram = librosa.util.normalize(chromagram, axis=0)</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=3, sharex=True)</span>
<span class="sd">    &gt;&gt;&gt; imgcq = librosa.display.specshow(librosa.amplitude_to_db(CQT,</span>
<span class="sd">    ...                                                         ref=np.max),</span>
<span class="sd">    ...                                  y_axis=&#39;cqt_note&#39;, x_axis=&#39;time&#39;,</span>
<span class="sd">    ...                                  ax=ax[0])</span>
<span class="sd">    &gt;&gt;&gt; ax[0].set(title=&#39;CQT Power&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].label_outer()</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(chromagram, y_axis=&#39;chroma&#39;, x_axis=&#39;time&#39;,</span>
<span class="sd">    ...                          ax=ax[1])</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(title=&#39;Chroma (wrapped CQT)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].label_outer()</span>
<span class="sd">    &gt;&gt;&gt; chroma = librosa.feature.chroma_stft(y=y, sr=sr)</span>
<span class="sd">    &gt;&gt;&gt; imgchroma = librosa.display.specshow(chroma, y_axis=&#39;chroma&#39;, x_axis=&#39;time&#39;, ax=ax[2])</span>
<span class="sd">    &gt;&gt;&gt; ax[2].set(title=&#39;librosa.feature.chroma_stft&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># How many fractional bins are we merging?</span>
    <span class="n">n_merge</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bins_per_octave</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_chroma</span>

    <span class="k">if</span> <span class="n">fmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="n">note_to_hz</span><span class="p">(</span><span class="s2">&quot;C1&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">n_merge</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span>
            <span class="s2">&quot;Incompatible CQ merge: &quot;</span>
            <span class="s2">&quot;input bins must be an &quot;</span>
            <span class="s2">&quot;integer multiple of output bins.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Tile the identity to merge fractional bins</span>
    <span class="n">cq_to_ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n_chroma</span><span class="p">),</span> <span class="n">n_merge</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Roll it left to center on the target bin</span>
    <span class="n">cq_to_ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">cq_to_ch</span><span class="p">,</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">n_merge</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># How many octaves are we repeating?</span>
    <span class="n">n_octaves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">n_input</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">)</span>

    <span class="c1"># Repeat and trim</span>
    <span class="n">cq_to_ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">cq_to_ch</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_octaves</span><span class="p">))[:,</span> <span class="p">:</span><span class="n">n_input</span><span class="p">]</span>

    <span class="c1"># What&#39;s the note number of the first bin in the CQT?</span>
    <span class="c1"># midi uses 12 bins per octave here</span>
    <span class="n">midi_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">hz_to_midi</span><span class="p">(</span><span class="n">fmin</span><span class="p">),</span> <span class="mi">12</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">base_c</span><span class="p">:</span>
        <span class="c1"># rotate to C</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="n">midi_0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># rotate to A</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="n">midi_0</span> <span class="o">-</span> <span class="mi">9</span>

    <span class="c1"># Adjust the roll in terms of how many chroma we want out</span>
    <span class="c1"># We need to be careful with rounding here</span>
    <span class="n">roll</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">roll</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_chroma</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">)))</span>

    <span class="c1"># Apply the roll</span>
    <span class="n">cq_to_ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">cq_to_ch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cq_to_ch</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">cq_to_ch</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cq_to_ch</span></div>


<div class="viewcode-block" id="window_bandwidth"><a class="viewcode-back" href="../../generated/librosa.filters.window_bandwidth.html#librosa.filters.window_bandwidth">[docs]</a><span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">window_bandwidth</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the equivalent noise bandwidth of a window function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window : callable or string</span>
<span class="sd">        A window function, or the name of a window function.</span>
<span class="sd">        Examples:</span>
<span class="sd">        - scipy.signal.hann</span>
<span class="sd">        - &#39;boxcar&#39;</span>
<span class="sd">    n : int &gt; 0</span>
<span class="sd">        The number of coefficients to use in estimating the</span>
<span class="sd">        window bandwidth</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bandwidth : float</span>
<span class="sd">        The equivalent noise bandwidth (in FFT bins) of the</span>
<span class="sd">        given window function</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    get_window</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">window</span>

    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">WINDOW_BANDWIDTHS</span><span class="p">:</span>
        <span class="n">win</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">WINDOW_BANDWIDTHS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">win</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">win</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="n">WINDOW_BANDWIDTHS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_window"><a class="viewcode-back" href="../../generated/librosa.filters.get_window.html#librosa.filters.get_window">[docs]</a><span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">fftbins</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute a window function.</span>

<span class="sd">    This is a wrapper for `scipy.signal.get_window` that additionally</span>
<span class="sd">    supports callable or pre-computed windows.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window : string, tuple, number, callable, or list-like</span>
<span class="sd">        The window specification:</span>

<span class="sd">        - If string, it&#39;s the name of the window function (e.g., `&#39;hann&#39;`)</span>
<span class="sd">        - If tuple, it&#39;s the name of the window function and any parameters</span>
<span class="sd">          (e.g., `(&#39;kaiser&#39;, 4.0)`)</span>
<span class="sd">        - If numeric, it is treated as the beta parameter of the `&#39;kaiser&#39;`</span>
<span class="sd">          window, as in `scipy.signal.get_window`.</span>
<span class="sd">        - If callable, it&#39;s a function that accepts one integer argument</span>
<span class="sd">          (the window length)</span>
<span class="sd">        - If list-like, it&#39;s a pre-computed window of the correct length `Nx`</span>

<span class="sd">    Nx : int &gt; 0</span>
<span class="sd">        The length of the window</span>

<span class="sd">    fftbins : bool, optional</span>
<span class="sd">        If True (default), create a periodic window for use with FFT</span>
<span class="sd">        If False, create a symmetric window for filter design applications.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    get_window : np.ndarray</span>
<span class="sd">        A window of length `Nx` and type `window`</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    scipy.signal.get_window</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ParameterError</span>
<span class="sd">        If `window` is supplied as a vector of length != `n_fft`,</span>
<span class="sd">        or is otherwise mis-specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">window</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">window</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">window</span><span class="p">):</span>
        <span class="c1"># TODO: if we add custom window functions in librosa, call them here</span>

        <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">fftbins</span><span class="o">=</span><span class="n">fftbins</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">)</span> <span class="o">==</span> <span class="n">Nx</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span>
            <span class="s2">&quot;Window size mismatch: &quot;</span> <span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2"> != </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="n">Nx</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;Invalid window specification: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">window</span><span class="p">))</span></div>


<span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_multirate_fb</span><span class="p">(</span>
    <span class="n">center_freqs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sample_rates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">Q</span><span class="o">=</span><span class="mf">25.0</span><span class="p">,</span>
    <span class="n">passband_ripple</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">stopband_attenuation</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">ftype</span><span class="o">=</span><span class="s2">&quot;ellip&quot;</span><span class="p">,</span>
    <span class="n">flayout</span><span class="o">=</span><span class="s2">&quot;sos&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Helper function to construct a multirate filterbank.</span>

<span class="sd">     A filter bank consists of multiple band-pass filters which divide the input signal</span>
<span class="sd">     into subbands. In the case of a multirate filter bank, the band-pass filters</span>
<span class="sd">     operate with resampled versions of the input signal, e.g. to keep the length</span>
<span class="sd">     of a filter constant while shifting its center frequency.</span>

<span class="sd">     This implementation uses `scipy.signal.iirdesign` to design the filters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    center_freqs : np.ndarray [shape=(n,), dtype=float]</span>
<span class="sd">        Center frequencies of the filter kernels.</span>
<span class="sd">        Also defines the number of filters in the filterbank.</span>

<span class="sd">    sample_rates : np.ndarray [shape=(n,), dtype=float]</span>
<span class="sd">        Samplerate for each filter (used for multirate filterbank).</span>

<span class="sd">    Q : float</span>
<span class="sd">        Q factor (influences the filter bandwidth).</span>

<span class="sd">    passband_ripple : float</span>
<span class="sd">        The maximum loss in the passband (dB)</span>
<span class="sd">        See `scipy.signal.iirdesign` for details.</span>

<span class="sd">    stopband_attenuation : float</span>
<span class="sd">        The minimum attenuation in the stopband (dB)</span>
<span class="sd">        See `scipy.signal.iirdesign` for details.</span>

<span class="sd">    ftype : str</span>
<span class="sd">        The type of IIR filter to design</span>
<span class="sd">        See `scipy.signal.iirdesign` for details.</span>

<span class="sd">    flayout : string</span>
<span class="sd">        Valid `output` argument for `scipy.signal.iirdesign`.</span>

<span class="sd">        - If `ba`, returns numerators/denominators of the transfer functions,</span>
<span class="sd">          used for filtering with `scipy.signal.filtfilt`.</span>
<span class="sd">          Can be unstable for high-order filters.</span>

<span class="sd">        - If `sos`, returns a series of second-order filters,</span>
<span class="sd">          used for filtering with `scipy.signal.sosfiltfilt`.</span>
<span class="sd">          Minimizes numerical precision errors for high-order filters, but is slower.</span>

<span class="sd">        - If `zpk`, returns zeros, poles, and system gains of the transfer functions.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filterbank : list [shape=(n,), dtype=float]</span>
<span class="sd">        Each list entry comprises the filter coefficients for a single filter.</span>
<span class="sd">    sample_rates : np.ndarray [shape=(n,), dtype=float]</span>
<span class="sd">        Samplerate for each filter.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    scipy.signal.iirdesign</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ParameterError</span>
<span class="sd">        If ``center_freqs`` is ``None``.</span>
<span class="sd">        If ``sample_rates`` is ``None``.</span>
<span class="sd">        If ``center_freqs.shape`` does not match ``sample_rates.shape``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">center_freqs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;center_freqs must be provided.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sample_rates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;sample_rates must be provided.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">center_freqs</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">sample_rates</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span>
            <span class="s2">&quot;Number of provided center_freqs and sample_rates must be equal.&quot;</span>
        <span class="p">)</span>

    <span class="n">nyquist</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sample_rates</span>
    <span class="n">filter_bandwidths</span> <span class="o">=</span> <span class="n">center_freqs</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>

    <span class="n">filterbank</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">cur_center_freq</span><span class="p">,</span> <span class="n">cur_nyquist</span><span class="p">,</span> <span class="n">cur_bw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">center_freqs</span><span class="p">,</span> <span class="n">nyquist</span><span class="p">,</span> <span class="n">filter_bandwidths</span>
    <span class="p">):</span>
        <span class="n">passband_freqs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">cur_center_freq</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">cur_bw</span><span class="p">,</span>
            <span class="n">cur_center_freq</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">cur_bw</span><span class="p">,</span>
        <span class="p">]</span> <span class="o">/</span> <span class="n">cur_nyquist</span>
        <span class="n">stopband_freqs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">cur_center_freq</span> <span class="o">-</span> <span class="n">cur_bw</span><span class="p">,</span>
            <span class="n">cur_center_freq</span> <span class="o">+</span> <span class="n">cur_bw</span><span class="p">,</span>
        <span class="p">]</span> <span class="o">/</span> <span class="n">cur_nyquist</span>

        <span class="n">cur_filter</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">iirdesign</span><span class="p">(</span>
            <span class="n">passband_freqs</span><span class="p">,</span>
            <span class="n">stopband_freqs</span><span class="p">,</span>
            <span class="n">passband_ripple</span><span class="p">,</span>
            <span class="n">stopband_attenuation</span><span class="p">,</span>
            <span class="n">analog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">ftype</span><span class="o">=</span><span class="n">ftype</span><span class="p">,</span>
            <span class="n">output</span><span class="o">=</span><span class="n">flayout</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">filterbank</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_filter</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filterbank</span><span class="p">,</span> <span class="n">sample_rates</span>


<div class="viewcode-block" id="mr_frequencies"><a class="viewcode-back" href="../../generated/librosa.filters.mr_frequencies.html#librosa.filters.mr_frequencies">[docs]</a><span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mr_frequencies</span><span class="p">(</span><span class="n">tuning</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Helper function for generating center frequency and sample rate pairs.</span>

<span class="sd">    This function will return center frequency and corresponding sample rates</span>
<span class="sd">    to obtain similar pitch filterbank settings as described in [#]_.</span>
<span class="sd">    Instead of starting with MIDI pitch `A0`, we start with `C0`.</span>

<span class="sd">    .. [#] Mller, Meinard.</span>
<span class="sd">           &quot;Information Retrieval for Music and Motion.&quot;</span>
<span class="sd">           Springer Verlag. 2007.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tuning : float [scalar]</span>
<span class="sd">        Tuning deviation from A440, measure as a fraction of the equally</span>
<span class="sd">        tempered semitone (1/12 of an octave).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    center_freqs : np.ndarray [shape=(n,), dtype=float]</span>
<span class="sd">        Center frequencies of the filter kernels.</span>
<span class="sd">        Also defines the number of filters in the filterbank.</span>
<span class="sd">    sample_rates : np.ndarray [shape=(n,), dtype=float]</span>
<span class="sd">        Sample rate for each filter, used for multirate filterbank.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    librosa.filters.semitone_filterbank</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">center_freqs</span> <span class="o">=</span> <span class="n">midi_to_hz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24</span> <span class="o">+</span> <span class="n">tuning</span><span class="p">,</span> <span class="mi">109</span> <span class="o">+</span> <span class="n">tuning</span><span class="p">))</span>

    <span class="n">sample_rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">36</span><span class="p">))</span>
        <span class="o">*</span> <span class="p">[</span>
            <span class="mi">882</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">70</span><span class="p">))</span>
        <span class="o">*</span> <span class="p">[</span>
            <span class="mi">4410</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">85</span><span class="p">))</span>
        <span class="o">*</span> <span class="p">[</span>
            <span class="mi">22050</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">center_freqs</span><span class="p">,</span> <span class="n">sample_rates</span></div>


<div class="viewcode-block" id="semitone_filterbank"><a class="viewcode-back" href="../../generated/librosa.filters.semitone_filterbank.html#librosa.filters.semitone_filterbank">[docs]</a><span class="k">def</span> <span class="nf">semitone_filterbank</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span> <span class="n">center_freqs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tuning</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sample_rates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flayout</span><span class="o">=</span><span class="s2">&quot;ba&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct a multi-rate bank of infinite-impulse response (IIR)</span>
<span class="sd">    band-pass filters at user-defined center frequencies and sample rates.</span>

<span class="sd">    By default, these center frequencies are set equal to the 88 fundamental</span>
<span class="sd">    frequencies of the grand piano keyboard, according to a pitch tuning standard</span>
<span class="sd">    of A440, that is, note A above middle C set to 440 Hz. The center frequencies</span>
<span class="sd">    are tuned to the twelve-tone equal temperament, which means that they grow</span>
<span class="sd">    exponentially at a rate of 2**(1/12), that is, twelve notes per octave.</span>

<span class="sd">    The A440 tuning can be changed by the user while keeping twelve-tone equal</span>
<span class="sd">    temperament. While A440 is currently the international standard in the music</span>
<span class="sd">    industry (ISO 16), some orchestras tune to A441-A445, whereas baroque musicians</span>
<span class="sd">    tune to A415.</span>

<span class="sd">    See [#]_ for details.</span>

<span class="sd">    .. [#] Mller, Meinard.</span>
<span class="sd">           &quot;Information Retrieval for Music and Motion.&quot;</span>
<span class="sd">           Springer Verlag. 2007.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    center_freqs : np.ndarray [shape=(n,), dtype=float]</span>
<span class="sd">        Center frequencies of the filter kernels.</span>
<span class="sd">        Also defines the number of filters in the filterbank.</span>
<span class="sd">    tuning : float [scalar]</span>
<span class="sd">        Tuning deviation from A440 as a fraction of a semitone (1/12 of an octave</span>
<span class="sd">        in equal temperament).</span>
<span class="sd">    sample_rates : np.ndarray [shape=(n,), dtype=float]</span>
<span class="sd">        Sample rates of each filter in the multirate filterbank.</span>
<span class="sd">    flayout : string</span>
<span class="sd">        - If `ba`, the standard difference equation is used for filtering with `scipy.signal.filtfilt`.</span>
<span class="sd">          Can be unstable for high-order filters.</span>
<span class="sd">        - If `sos`, a series of second-order filters is used for filtering with `scipy.signal.sosfiltfilt`.</span>
<span class="sd">          Minimizes numerical precision errors for high-order filters, but is slower.</span>
<span class="sd">    **kwargs : additional keyword arguments</span>
<span class="sd">        Additional arguments to the private function `_multirate_fb()`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filterbank : list [shape=(n,), dtype=float]</span>
<span class="sd">        Each list entry contains the filter coefficients for a single filter.</span>
<span class="sd">    fb_sample_rates : np.ndarray [shape=(n,), dtype=float]</span>
<span class="sd">        Sample rate for each filter.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    librosa.cqt</span>
<span class="sd">    librosa.iirt</span>
<span class="sd">    librosa.filters.mr_frequencies</span>
<span class="sd">    scipy.signal.iirdesign</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import scipy.signal</span>
<span class="sd">    &gt;&gt;&gt; semitone_filterbank, sample_rates = librosa.filters.semitone_filterbank()</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; for cur_sr, cur_filter in zip(sample_rates, semitone_filterbank):</span>
<span class="sd">    ...    w, h = scipy.signal.freqz(cur_filter[0], cur_filter[1], worN=2000)</span>
<span class="sd">    ...    ax.semilogx((cur_sr / (2 * np.pi)) * w, 20 * np.log10(abs(h)))</span>
<span class="sd">    &gt;&gt;&gt; ax.set(xlim=[20, 10e3], ylim=[-60, 3], title=&#39;Magnitude Responses of the Pitch Filterbank&#39;,</span>
<span class="sd">    ...        xlabel=&#39;Log-Frequency (Hz)&#39;, ylabel=&#39;Magnitude (dB)&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">center_freqs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sample_rates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">center_freqs</span><span class="p">,</span> <span class="n">sample_rates</span> <span class="o">=</span> <span class="n">mr_frequencies</span><span class="p">(</span><span class="n">tuning</span><span class="p">)</span>

    <span class="n">filterbank</span><span class="p">,</span> <span class="n">fb_sample_rates</span> <span class="o">=</span> <span class="n">_multirate_fb</span><span class="p">(</span>
        <span class="n">center_freqs</span><span class="o">=</span><span class="n">center_freqs</span><span class="p">,</span> <span class="n">sample_rates</span><span class="o">=</span><span class="n">sample_rates</span><span class="p">,</span> <span class="n">flayout</span><span class="o">=</span><span class="n">flayout</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">filterbank</span><span class="p">,</span> <span class="n">fb_sample_rates</span></div>


<span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">__window_ss_fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">win_sq</span><span class="p">,</span> <span class="n">n_frames</span><span class="p">,</span> <span class="n">hop_length</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Helper function for window sum-square calculation.&quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">n_fft</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">win_sq</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_frames</span><span class="p">):</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">hop_length</span>
        <span class="n">x</span><span class="p">[</span><span class="n">sample</span> <span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sample</span> <span class="o">+</span> <span class="n">n_fft</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">win_sq</span><span class="p">[:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">n_fft</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">sample</span><span class="p">))]</span>


<div class="viewcode-block" id="window_sumsquare"><a class="viewcode-back" href="../../generated/librosa.filters.window_sumsquare.html#librosa.filters.window_sumsquare">[docs]</a><span class="k">def</span> <span class="nf">window_sumsquare</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">window</span><span class="p">,</span>
    <span class="n">n_frames</span><span class="p">,</span>
    <span class="n">hop_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
    <span class="n">win_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">n_fft</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the sum-square envelope of a window function at a given hop length.</span>

<span class="sd">    This is used to estimate modulation effects induced by windowing observations</span>
<span class="sd">    in short-time Fourier transforms.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window : string, tuple, number, callable, or list-like</span>
<span class="sd">        Window specification, as in `get_window`</span>
<span class="sd">    n_frames : int &gt; 0</span>
<span class="sd">        The number of analysis frames</span>
<span class="sd">    hop_length : int &gt; 0</span>
<span class="sd">        The number of samples to advance between frames</span>
<span class="sd">    win_length : [optional]</span>
<span class="sd">        The length of the window function.  By default, this matches ``n_fft``.</span>
<span class="sd">    n_fft : int &gt; 0</span>
<span class="sd">        The length of each analysis frame.</span>
<span class="sd">    dtype : np.dtype</span>
<span class="sd">        The data type of the output</span>
<span class="sd">    norm : {np.inf, -np.inf, 0, float &gt; 0, None}</span>
<span class="sd">        Normalization mode used in window construction.</span>
<span class="sd">        Note that this does not affect the squaring operation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    wss : np.ndarray, shape=``(n_fft + hop_length * (n_frames - 1))``</span>
<span class="sd">        The sum-squared envelope of the window function</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    For a fixed frame length (2048), compare modulation effects for a Hann window</span>
<span class="sd">    at different hop lengths:</span>

<span class="sd">    &gt;&gt;&gt; n_frames = 50</span>
<span class="sd">    &gt;&gt;&gt; wss_256 = librosa.filters.window_sumsquare(window=&#39;hann&#39;, n_frames=n_frames, hop_length=256)</span>
<span class="sd">    &gt;&gt;&gt; wss_512 = librosa.filters.window_sumsquare(window=&#39;hann&#39;, n_frames=n_frames, hop_length=512)</span>
<span class="sd">    &gt;&gt;&gt; wss_1024 = librosa.filters.window_sumsquare(window=&#39;hann&#39;, n_frames=n_frames, hop_length=1024)</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=3, sharey=True)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].plot(wss_256)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].set(title=&#39;hop_length=256&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].plot(wss_512)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(title=&#39;hop_length=512&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[2].plot(wss_1024)</span>
<span class="sd">    &gt;&gt;&gt; ax[2].set(title=&#39;hop_length=1024&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">win_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">win_length</span> <span class="o">=</span> <span class="n">n_fft</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">n_fft</span> <span class="o">+</span> <span class="n">hop_length</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_frames</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

    <span class="c1"># Compute the squared window at the desired length</span>
    <span class="n">win_sq</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">win_length</span><span class="p">)</span>
    <span class="n">win_sq</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">win_sq</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">win_sq</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">pad_center</span><span class="p">(</span><span class="n">win_sq</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_fft</span><span class="p">)</span>

    <span class="c1"># Fill the envelope</span>
    <span class="n">__window_ss_fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">win_sq</span><span class="p">,</span> <span class="n">n_frames</span><span class="p">,</span> <span class="n">hop_length</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span></div>


<div class="viewcode-block" id="diagonal_filter"><a class="viewcode-back" href="../../generated/librosa.filters.diagonal_filter.html#librosa.filters.diagonal_filter">[docs]</a><span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">diagonal_filter</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">slope</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zero_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build a two-dimensional diagonal filter.</span>

<span class="sd">    This is primarily used for smoothing recurrence or self-similarity matrices.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window : string, tuple, number, callable, or list-like</span>
<span class="sd">        The window function to use for the filter.</span>

<span class="sd">        See `get_window` for details.</span>

<span class="sd">        Note that the window used here should be non-negative.</span>

<span class="sd">    n : int &gt; 0</span>
<span class="sd">        the length of the filter</span>

<span class="sd">    slope : float</span>
<span class="sd">        The slope of the diagonal filter to produce</span>

<span class="sd">    angle : float or None</span>
<span class="sd">        If given, the slope parameter is ignored,</span>
<span class="sd">        and angle directly sets the orientation of the filter (in radians).</span>
<span class="sd">        Otherwise, angle is inferred as `arctan(slope)`.</span>

<span class="sd">    zero_mean : bool</span>
<span class="sd">        If True, a zero-mean filter is used.</span>
<span class="sd">        Otherwise, a non-negative averaging filter is used.</span>

<span class="sd">        This should be enabled if you want to enhance paths and suppress</span>
<span class="sd">        blocks.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    kernel : np.ndarray, shape=[(m, m)]</span>
<span class="sd">        The 2-dimensional filter kernel</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 10.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">angle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>

    <span class="n">win</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">fftbins</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">win</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span>
            <span class="n">win</span><span class="p">,</span> <span class="mi">45</span> <span class="o">-</span> <span class="n">angle</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">win</span><span class="p">)</span>
    <span class="n">win</span> <span class="o">/=</span> <span class="n">win</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">zero_mean</span><span class="p">:</span>
        <span class="n">win</span> <span class="o">-=</span> <span class="n">win</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">win</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013--2022, librosa development team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  

<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: 0.9.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="filters.html">0.9.0</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-171031946-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-171031946-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>