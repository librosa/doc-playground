<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>librosa.display &mdash; librosa 0.9.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
            <a href="../../index.html">
            <img src="../../_static/librosa_logo_text.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.9.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../core.html">Core IO and DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../display.html">Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../feature.html">Feature extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../onset.html">Onset detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beat.html">Beat and tempo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../decompose.html">Spectrogram decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../effects.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../segment.html">Temporal segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sequence.html">Sequential modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../util.html">Utilities</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../multichannel.html">Multi-channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filters.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cache.html">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ioformats.html">Advanced I/O Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced.html">Advanced examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../recordings.html">Example files</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">librosa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>librosa.display</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             

<div class="admonition danger">
    <p class="admonition-title"> Caution </p>
  <p>
    
        
            You're reading an old version of this documentation.
            If you want up-to-date information, please have a look at <a href="../../../0.9.1/index.html">0.9.1</a>.
        
    
  </p>
</div>


  <h1>Source code for librosa.display</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Display</span>
<span class="sd">=======</span>

<span class="sd">Data visualization</span>
<span class="sd">------------------</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    specshow</span>
<span class="sd">    waveshow</span>

<span class="sd">Axis formatting</span>
<span class="sd">---------------</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    TimeFormatter</span>
<span class="sd">    NoteFormatter</span>
<span class="sd">    SvaraFormatter</span>
<span class="sd">    LogHzFormatter</span>
<span class="sd">    ChromaFormatter</span>
<span class="sd">    ChromaSvaraFormatter</span>
<span class="sd">    TonnetzFormatter</span>

<span class="sd">Miscellaneous</span>
<span class="sd">-------------</span>
<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    cmap</span>
<span class="sd">    AdaptiveWaveplot</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib.cm</span> <span class="kn">import</span> <span class="n">get_cmap</span>
<span class="kn">from</span> <span class="nn">matplotlib.axes</span> <span class="kn">import</span> <span class="n">Axes</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">Formatter</span><span class="p">,</span> <span class="n">ScalarFormatter</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">LogLocator</span><span class="p">,</span> <span class="n">FixedLocator</span><span class="p">,</span> <span class="n">MaxNLocator</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">SymmetricalLogLocator</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">packaging.version</span> <span class="kn">import</span> <span class="n">parse</span> <span class="k">as</span> <span class="n">version_parse</span>


<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">core</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">.util.exceptions</span> <span class="kn">import</span> <span class="n">ParameterError</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;specshow&quot;</span><span class="p">,</span>
    <span class="s2">&quot;waveshow&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cmap&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TimeFormatter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoteFormatter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LogHzFormatter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ChromaFormatter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TonnetzFormatter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AdaptiveWaveplot&quot;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="TimeFormatter"><a class="viewcode-back" href="../../generated/librosa.display.TimeFormatter.html#librosa.display.TimeFormatter">[docs]</a><span class="k">class</span> <span class="nc">TimeFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A tick formatter for time axes.</span>

<span class="sd">    Automatically switches between seconds, minutes:seconds,</span>
<span class="sd">    or hours:minutes:seconds.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lag : bool</span>
<span class="sd">        If ``True``, then the time axis is interpreted in lag coordinates.</span>
<span class="sd">        Anything past the midpoint will be converted to negative time.</span>

<span class="sd">    unit : str or None</span>
<span class="sd">        Abbreviation of the physical unit for axis labels and ticks.</span>
<span class="sd">        Either equal to `s` (seconds) or `ms` (milliseconds) or None (default).</span>
<span class="sd">        If set to None, the resulting TimeFormatter object adapts its string</span>
<span class="sd">        representation to the duration of the underlying time range:</span>
<span class="sd">        `hh:mm:ss` above 3600 seconds; `mm:ss` between 60 and 3600 seconds;</span>
<span class="sd">        and `ss` below 60 seconds.</span>


<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    matplotlib.ticker.Formatter</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    For normal time</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; times = np.arange(30)</span>
<span class="sd">    &gt;&gt;&gt; values = np.random.randn(len(times))</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(times, values)</span>
<span class="sd">    &gt;&gt;&gt; ax.xaxis.set_major_formatter(librosa.display.TimeFormatter())</span>
<span class="sd">    &gt;&gt;&gt; ax.set(xlabel=&#39;Time&#39;)</span>

<span class="sd">    Manually set the physical time unit of the x-axis to milliseconds</span>

<span class="sd">    &gt;&gt;&gt; times = np.arange(100)</span>
<span class="sd">    &gt;&gt;&gt; values = np.random.randn(len(times))</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(times, values)</span>
<span class="sd">    &gt;&gt;&gt; ax.xaxis.set_major_formatter(librosa.display.TimeFormatter(unit=&#39;ms&#39;))</span>
<span class="sd">    &gt;&gt;&gt; ax.set(xlabel=&#39;Time (ms)&#39;)</span>

<span class="sd">    For lag plots</span>

<span class="sd">    &gt;&gt;&gt; times = np.arange(60)</span>
<span class="sd">    &gt;&gt;&gt; values = np.random.randn(len(times))</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(times, values)</span>
<span class="sd">    &gt;&gt;&gt; ax.xaxis.set_major_formatter(librosa.display.TimeFormatter(lag=True))</span>
<span class="sd">    &gt;&gt;&gt; ax.set(xlabel=&#39;Lag&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TimeFormatter.__init__"><a class="viewcode-back" href="../../generated/librosa.display.TimeFormatter.html#librosa.display.TimeFormatter.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;Unknown time unit: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lag</span> <span class="o">=</span> <span class="n">lag</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the time format as pos&quot;&quot;&quot;</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">dmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">get_data_interval</span><span class="p">()</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">get_view_interval</span><span class="p">()</span>

        <span class="c1"># In lag-time axes, anything greater than dmax / 2 is negative time</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lag</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">dmax</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="c1"># In lag mode, don&#39;t tick past the limits of the data</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">dmax</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">dmax</span><span class="p">)</span>
            <span class="c1"># Do we need to tweak vmin/vmax here?</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.3g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;ms&quot;</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.3g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span> <span class="o">&gt;</span> <span class="mi">3600</span><span class="p">:</span>
                <span class="c1"># Hours viz</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">:</span><span class="si">{:02d}</span><span class="s2">:</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">),</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">,</span> <span class="mi">60</span><span class="p">)),</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">60</span><span class="p">)),</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
                <span class="c1"># Minutes viz</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">:</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">60</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Seconds viz</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.2g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Milliseconds viz</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{:s}{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span></div>


<div class="viewcode-block" id="NoteFormatter"><a class="viewcode-back" href="../../generated/librosa.display.NoteFormatter.html#librosa.display.NoteFormatter">[docs]</a><span class="k">class</span> <span class="nc">NoteFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ticker formatter for Notes</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    octave : bool</span>
<span class="sd">        If ``True``, display the octave number along with the note name.</span>

<span class="sd">        Otherwise, only show the note name (and cent deviation)</span>

<span class="sd">    major : bool</span>
<span class="sd">        If ``True``, ticks are always labeled.</span>

<span class="sd">        If ``False``, ticks are only labeled if the span is less than 2 octaves</span>

<span class="sd">    key : str</span>
<span class="sd">        Key for determining pitch spelling.</span>

<span class="sd">    unicode : bool</span>
<span class="sd">        If ``True``, use unicode symbols for accidentals.</span>

<span class="sd">        If ``False``, use ASCII symbols for accidentals.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    LogHzFormatter</span>
<span class="sd">    matplotlib.ticker.Formatter</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; values = librosa.midi_to_hz(np.arange(48, 72))</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=2)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].bar(np.arange(len(values)), values)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].set(ylabel=&#39;Hz&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].bar(np.arange(len(values)), values)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].yaxis.set_major_formatter(librosa.display.NoteFormatter())</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(ylabel=&#39;Note&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="NoteFormatter.__init__"><a class="viewcode-back" href="../../generated/librosa.display.NoteFormatter.html#librosa.display.NoteFormatter.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">octave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">major</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;C:maj&quot;</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">octave</span> <span class="o">=</span> <span class="n">octave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">=</span> <span class="n">major</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unicode</span> <span class="o">=</span> <span class="n">unicode</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Only use cent precision if our vspan is less than an octave</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">get_view_interval</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="ow">and</span> <span class="n">vmax</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmin</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="n">cents</span> <span class="o">=</span> <span class="n">vmax</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmin</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">hz_to_note</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">octave</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">octave</span><span class="p">,</span> <span class="n">cents</span><span class="o">=</span><span class="n">cents</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unicode</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="SvaraFormatter"><a class="viewcode-back" href="../../generated/librosa.display.SvaraFormatter.html#librosa.display.SvaraFormatter">[docs]</a><span class="k">class</span> <span class="nc">SvaraFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ticker formatter for Svara</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    octave : bool</span>
<span class="sd">        If ``True``, display the octave number along with the note name.</span>

<span class="sd">        Otherwise, only show the note name (and cent deviation)</span>

<span class="sd">    major : bool</span>
<span class="sd">        If ``True``, ticks are always labeled.</span>

<span class="sd">        If ``False``, ticks are only labeled if the span is less than 2 octaves</span>

<span class="sd">    Sa : number &gt; 0</span>
<span class="sd">        Frequency (in Hz) of Sa</span>

<span class="sd">    mela : str or int</span>
<span class="sd">        For Carnatic svara, the index or name of the melakarta raga in question</span>

<span class="sd">        To use Hindustani svara, set ``mela=None``</span>

<span class="sd">    unicode : bool</span>
<span class="sd">        If ``True``, use unicode symbols for accidentals.</span>

<span class="sd">        If ``False``, use ASCII symbols for accidentals.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    NoteFormatter</span>
<span class="sd">    matplotlib.ticker.Formatter</span>
<span class="sd">    librosa.hz_to_svara_c</span>
<span class="sd">    librosa.hz_to_svara_h</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; values = librosa.midi_to_hz(np.arange(48, 72))</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=2)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].bar(np.arange(len(values)), values)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].set(ylabel=&#39;Hz&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].bar(np.arange(len(values)), values)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].yaxis.set_major_formatter(librosa.display.SvaraFormatter(261))</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(ylabel=&#39;Note&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SvaraFormatter.__init__"><a class="viewcode-back" href="../../generated/librosa.display.SvaraFormatter.html#librosa.display.SvaraFormatter.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">Sa</span><span class="p">,</span> <span class="n">octave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">major</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">abbr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mela</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>

        <span class="k">if</span> <span class="n">Sa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span>
                <span class="s2">&quot;Sa frequency is required for svara display formatting&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Sa</span> <span class="o">=</span> <span class="n">Sa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">octave</span> <span class="o">=</span> <span class="n">octave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">=</span> <span class="n">major</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abbr</span> <span class="o">=</span> <span class="n">abbr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mela</span> <span class="o">=</span> <span class="n">mela</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unicode</span> <span class="o">=</span> <span class="n">unicode</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Only use cent precision if our vspan is less than an octave</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">get_view_interval</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="ow">and</span> <span class="n">vmax</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmin</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mela</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">hz_to_svara_h</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">Sa</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Sa</span><span class="p">,</span> <span class="n">octave</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">octave</span><span class="p">,</span> <span class="n">abbr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">abbr</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unicode</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">hz_to_svara_c</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">Sa</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Sa</span><span class="p">,</span>
                <span class="n">mela</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mela</span><span class="p">,</span>
                <span class="n">octave</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">octave</span><span class="p">,</span>
                <span class="n">abbr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">abbr</span><span class="p">,</span>
                <span class="n">unicode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unicode</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="LogHzFormatter"><a class="viewcode-back" href="../../generated/librosa.display.LogHzFormatter.html#librosa.display.LogHzFormatter">[docs]</a><span class="k">class</span> <span class="nc">LogHzFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ticker formatter for logarithmic frequency</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    major : bool</span>
<span class="sd">        If ``True``, ticks are always labeled.</span>

<span class="sd">        If ``False``, ticks are only labeled if the span is less than 2 octaves</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    NoteFormatter</span>
<span class="sd">    matplotlib.ticker.Formatter</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; values = librosa.midi_to_hz(np.arange(48, 72))</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=2)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].bar(np.arange(len(values)), values)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].yaxis.set_major_formatter(librosa.display.LogHzFormatter())</span>
<span class="sd">    &gt;&gt;&gt; ax[0].set(ylabel=&#39;Hz&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].bar(np.arange(len(values)), values)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].yaxis.set_major_formatter(librosa.display.NoteFormatter())</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(ylabel=&#39;Note&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LogHzFormatter.__init__"><a class="viewcode-back" href="../../generated/librosa.display.LogHzFormatter.html#librosa.display.LogHzFormatter.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">major</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="o">=</span> <span class="n">major</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">get_view_interval</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">major</span> <span class="ow">and</span> <span class="n">vmax</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmin</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="ChromaFormatter"><a class="viewcode-back" href="../../generated/librosa.display.ChromaFormatter.html#librosa.display.ChromaFormatter">[docs]</a><span class="k">class</span> <span class="nc">ChromaFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A formatter for chroma axes</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    matplotlib.ticker.Formatter</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; values = np.arange(12)</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(values)</span>
<span class="sd">    &gt;&gt;&gt; ax.yaxis.set_major_formatter(librosa.display.ChromaFormatter())</span>
<span class="sd">    &gt;&gt;&gt; ax.set(ylabel=&#39;Pitch class&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ChromaFormatter.__init__"><a class="viewcode-back" href="../../generated/librosa.display.ChromaFormatter.html#librosa.display.ChromaFormatter.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;C:maj&quot;</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unicode</span> <span class="o">=</span> <span class="n">unicode</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format for chroma positions&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">midi_to_note</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">octave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cents</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unicode</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ChromaSvaraFormatter"><a class="viewcode-back" href="../../generated/librosa.display.ChromaSvaraFormatter.html#librosa.display.ChromaSvaraFormatter">[docs]</a><span class="k">class</span> <span class="nc">ChromaSvaraFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A formatter for chroma axes with svara instead of notes.</span>

<span class="sd">    If mela is given, Carnatic svara names will be used.</span>

<span class="sd">    Otherwise, Hindustani svara names will be used.</span>

<span class="sd">    If `Sa` is not given, it will default to 0 (equivalent to `C`).</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ChromaFormatter</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ChromaSvaraFormatter.__init__"><a class="viewcode-back" href="../../generated/librosa.display.ChromaSvaraFormatter.html#librosa.display.ChromaSvaraFormatter.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Sa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mela</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">abbr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Sa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Sa</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sa</span> <span class="o">=</span> <span class="n">Sa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mela</span> <span class="o">=</span> <span class="n">mela</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abbr</span> <span class="o">=</span> <span class="n">abbr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unicode</span> <span class="o">=</span> <span class="n">unicode</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format for chroma positions&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mela</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">midi_to_svara_c</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                <span class="n">Sa</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Sa</span><span class="p">,</span>
                <span class="n">mela</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mela</span><span class="p">,</span>
                <span class="n">octave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">abbr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">abbr</span><span class="p">,</span>
                <span class="n">unicode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unicode</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">midi_to_svara_h</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">Sa</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Sa</span><span class="p">,</span> <span class="n">octave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">abbr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">abbr</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unicode</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="TonnetzFormatter"><a class="viewcode-back" href="../../generated/librosa.display.TonnetzFormatter.html#librosa.display.TonnetzFormatter">[docs]</a><span class="k">class</span> <span class="nc">TonnetzFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A formatter for tonnetz axes</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    matplotlib.ticker.Formatter</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; values = np.arange(6)</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(values)</span>
<span class="sd">    &gt;&gt;&gt; ax.yaxis.set_major_formatter(librosa.display.TonnetzFormatter())</span>
<span class="sd">    &gt;&gt;&gt; ax.set(ylabel=&#39;Tonnetz&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format for tonnetz positions&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;5$_x$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;5$_y$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;m3$_x$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;m3$_y$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;M3$_x$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;M3$_y$&quot;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span></div>


<div class="viewcode-block" id="AdaptiveWaveplot"><a class="viewcode-back" href="../../generated/librosa.display.AdaptiveWaveplot.html#librosa.display.AdaptiveWaveplot">[docs]</a><span class="k">class</span> <span class="nc">AdaptiveWaveplot</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A helper class for managing adaptive wave visualizations.</span>

<span class="sd">    This object is used to dynamically switch between sample-based and envelope-based</span>
<span class="sd">    visualizations of waveforms.</span>
<span class="sd">    When the display is zoomed in such that no more than `max_samples` would be</span>
<span class="sd">    visible, the sample-based display is used.</span>
<span class="sd">    When displaying the raw samples would require more than `max_samples`, an</span>
<span class="sd">    envelope-based plot is used instead.</span>

<span class="sd">    You should never need to instantiate this object directly, as it is constructed</span>
<span class="sd">    automatically by `waveshow`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    times : np.ndarray</span>
<span class="sd">        An array containing the time index (in seconds) for each sample.</span>

<span class="sd">    y : np.ndarray</span>
<span class="sd">        An array containing the (monophonic) wave samples.</span>

<span class="sd">    steps : matplotlib.lines.Lines2D</span>
<span class="sd">        The matplotlib artist used for the sample-based visualization.</span>
<span class="sd">        This is constructed by `matplotlib.pyplot.step`.</span>

<span class="sd">    envelope : matplotlib.collections.PolyCollection</span>
<span class="sd">        The matplotlib artist used for the envelope-based visualization.</span>
<span class="sd">        This is constructed by `matplotlib.pyplot.fill_between`.</span>

<span class="sd">    sr : number &gt; 0</span>
<span class="sd">        The sampling rate of the audio</span>

<span class="sd">    max_samples : int &gt; 0</span>
<span class="sd">        The maximum number of samples to use for sample-based display.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    waveshow</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AdaptiveWaveplot.__init__"><a class="viewcode-back" href="../../generated/librosa.display.AdaptiveWaveplot.html#librosa.display.AdaptiveWaveplot.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mi">11025</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times</span> <span class="o">=</span> <span class="n">times</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">envelope</span> <span class="o">=</span> <span class="n">envelope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr</span> <span class="o">=</span> <span class="n">sr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_samples</span> <span class="o">=</span> <span class="n">max_samples</span></div>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the matplotlib display according to the current viewport limits.</span>

<span class="sd">        This is a callback function, and should not be used directly.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib axes object</span>
<span class="sd">            The axes object to update</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lims</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">viewLim</span>

        <span class="c1"># Does our width cover fewer than max_samples?</span>
        <span class="c1"># If so, then use the sample-based plot</span>
        <span class="k">if</span> <span class="n">lims</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_samples</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">envelope</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Now check that our viewport</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">lims</span><span class="o">.</span><span class="n">x0</span> <span class="o">&lt;=</span> <span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">lims</span><span class="o">.</span><span class="n">x1</span> <span class="o">&gt;=</span> <span class="n">xdata</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># Viewport expands beyond current data in steps; update</span>
                <span class="c1"># we want to cover a window of self.max_samples centered on the current viewport</span>
                <span class="n">midpoint_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">lims</span><span class="o">.</span><span class="n">x1</span> <span class="o">+</span> <span class="n">lims</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">idx_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">midpoint_time</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_samples</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="n">idx_start</span> <span class="p">:</span> <span class="n">idx_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_samples</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">idx_start</span> <span class="p">:</span> <span class="n">idx_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_samples</span><span class="p">],</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Otherwise, use the envelope plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">envelope</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>


<div class="viewcode-block" id="cmap"><a class="viewcode-back" href="../../generated/librosa.display.cmap.html#librosa.display.cmap">[docs]</a><span class="k">def</span> <span class="nf">cmap</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap_seq</span><span class="o">=</span><span class="s2">&quot;magma&quot;</span><span class="p">,</span> <span class="n">cmap_bool</span><span class="o">=</span><span class="s2">&quot;gray_r&quot;</span><span class="p">,</span> <span class="n">cmap_div</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a default colormap from the given data.</span>

<span class="sd">    If the data is boolean, use a black and white colormap.</span>

<span class="sd">    If the data has both positive and negative values,</span>
<span class="sd">    use a diverging colormap.</span>

<span class="sd">    Otherwise, use a sequential colormap.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : np.ndarray</span>
<span class="sd">        Input data</span>
<span class="sd">    robust : bool</span>
<span class="sd">        If True, discard the top and bottom 2% of data when calculating</span>
<span class="sd">        range.</span>
<span class="sd">    cmap_seq : str</span>
<span class="sd">        The sequential colormap name</span>
<span class="sd">    cmap_bool : str</span>
<span class="sd">        The boolean colormap name</span>
<span class="sd">    cmap_div : str</span>
<span class="sd">        The diverging colormap name</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cmap : matplotlib.colors.Colormap</span>
<span class="sd">        The colormap to use for ``data``</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    matplotlib.pyplot.colormaps</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap_bool</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
        <span class="n">min_p</span><span class="p">,</span> <span class="n">max_p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">98</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">min_p</span><span class="p">,</span> <span class="n">max_p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span>

    <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="n">min_p</span><span class="p">,</span> <span class="n">max_p</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">min_val</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">max_val</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap_seq</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap_div</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">__envelope</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">hop</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the max-envelope of non-overlapping frames of x at length hop</span>

<span class="sd">    x is assumed to be multi-channel, of shape (n_channels, n_samples).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">frame_length</span><span class="o">=</span><span class="n">hop</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">x_frame</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<div class="viewcode-block" id="specshow"><a class="viewcode-back" href="../../generated/librosa.display.specshow.html#librosa.display.specshow">[docs]</a><span class="k">def</span> <span class="nf">specshow</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">x_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">x_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span>
    <span class="n">hop_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
    <span class="n">n_fft</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">win_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tuning</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">bins_per_octave</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;C:maj&quot;</span><span class="p">,</span>
    <span class="n">Sa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mela</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">thaat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">auto_aspect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">htk</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display a spectrogram/chromagram/cqt/etc.</span>

<span class="sd">    For a detailed overview of this function, see :ref:`sphx_glr_auto_examples_plot_display.py`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : np.ndarray [shape=(d, n)]</span>
<span class="sd">        Matrix to display (e.g., spectrogram)</span>

<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        Sample rate used to determine time scale in x-axis.</span>

<span class="sd">    hop_length : int &gt; 0 [scalar]</span>
<span class="sd">        Hop length, also used to determine time scale in x-axis</span>

<span class="sd">    n_fft : int &gt; 0 or None</span>
<span class="sd">        Number of samples per frame in STFT/spectrogram displays.</span>
<span class="sd">        By default, this will be inferred from the shape of ``data``</span>
<span class="sd">        as ``2 * (d - 1)``.</span>
<span class="sd">        If ``data`` was generated using an odd frame length, the correct</span>
<span class="sd">        value can be specified here.</span>

<span class="sd">    win_length : int &gt; 0 or None</span>
<span class="sd">        The number of samples per window.</span>
<span class="sd">        By default, this will be inferred to match ``n_fft``.</span>
<span class="sd">        This is primarily useful for specifying odd window lengths in</span>
<span class="sd">        Fourier tempogram displays.</span>

<span class="sd">    x_axis, y_axis : None or str</span>
<span class="sd">        Range for the x- and y-axes.</span>

<span class="sd">        Valid types are:</span>

<span class="sd">        - None, &#39;none&#39;, or &#39;off&#39; : no axis decoration is displayed.</span>

<span class="sd">        Frequency types:</span>

<span class="sd">        - &#39;linear&#39;, &#39;fft&#39;, &#39;hz&#39; : frequency range is determined by</span>
<span class="sd">          the FFT window and sampling rate.</span>
<span class="sd">        - &#39;log&#39; : the spectrum is displayed on a log scale.</span>
<span class="sd">        - &#39;fft_note&#39;: the spectrum is displayed on a log scale with pitches marked.</span>
<span class="sd">        - &#39;fft_svara&#39;: the spectrum is displayed on a log scale with svara marked.</span>
<span class="sd">        - &#39;mel&#39; : frequencies are determined by the mel scale.</span>
<span class="sd">        - &#39;cqt_hz&#39; : frequencies are determined by the CQT scale.</span>
<span class="sd">        - &#39;cqt_note&#39; : pitches are determined by the CQT scale.</span>
<span class="sd">        - &#39;cqt_svara&#39; : like `cqt_note` but using Hindustani or Carnatic svara</span>

<span class="sd">        All frequency types are plotted in units of Hz.</span>

<span class="sd">        Any spectrogram parameters (hop_length, sr, bins_per_octave, etc.)</span>
<span class="sd">        used to generate the input data should also be provided when</span>
<span class="sd">        calling `specshow`.</span>

<span class="sd">        Categorical types:</span>

<span class="sd">        - &#39;chroma&#39; : pitches are determined by the chroma filters.</span>
<span class="sd">          Pitch classes are arranged at integer locations (0-11) according to</span>
<span class="sd">          a given key.</span>

<span class="sd">        - `chroma_h`, `chroma_c`: pitches are determined by chroma filters,</span>
<span class="sd">          and labeled as svara in the Hindustani (`chroma_h`) or Carnatic (`chroma_c`)</span>
<span class="sd">          according to a given thaat (Hindustani) or melakarta raga (Carnatic).</span>

<span class="sd">        - &#39;tonnetz&#39; : axes are labeled by Tonnetz dimensions (0-5)</span>
<span class="sd">        - &#39;frames&#39; : markers are shown as frame counts.</span>

<span class="sd">        Time types:</span>

<span class="sd">        - &#39;time&#39; : markers are shown as milliseconds, seconds, minutes, or hours.</span>
<span class="sd">                Values are plotted in units of seconds.</span>
<span class="sd">        - &#39;s&#39; : markers are shown as seconds.</span>
<span class="sd">        - &#39;ms&#39; : markers are shown as milliseconds.</span>
<span class="sd">        - &#39;lag&#39; : like time, but past the halfway point counts as negative values.</span>
<span class="sd">        - &#39;lag_s&#39; : same as lag, but in seconds.</span>
<span class="sd">        - &#39;lag_ms&#39; : same as lag, but in milliseconds.</span>

<span class="sd">        Rhythm:</span>

<span class="sd">        - &#39;tempo&#39; : markers are shown as beats-per-minute (BPM)</span>
<span class="sd">            using a logarithmic scale.  This is useful for</span>
<span class="sd">            visualizing the outputs of `feature.tempogram`.</span>

<span class="sd">        - &#39;fourier_tempo&#39; : same as `&#39;tempo&#39;`, but used when</span>
<span class="sd">            tempograms are calculated in the Frequency domain</span>
<span class="sd">            using `feature.fourier_tempogram`.</span>

<span class="sd">    x_coords, y_coords : np.ndarray [shape=data.shape[0 or 1]]</span>
<span class="sd">        Optional positioning coordinates of the input data.</span>
<span class="sd">        These can be use to explicitly set the location of each</span>
<span class="sd">        element ``data[i, j]``, e.g., for displaying beat-synchronous</span>
<span class="sd">        features in natural time coordinates.</span>

<span class="sd">        If not provided, they are inferred from ``x_axis`` and ``y_axis``.</span>

<span class="sd">    fmin : float &gt; 0 [scalar] or None</span>
<span class="sd">        Frequency of the lowest spectrogram bin.  Used for Mel and CQT</span>
<span class="sd">        scales.</span>

<span class="sd">        If ``y_axis`` is `cqt_hz` or `cqt_note` and ``fmin`` is not given,</span>
<span class="sd">        it is set by default to ``note_to_hz(&#39;C1&#39;)``.</span>

<span class="sd">    fmax : float &gt; 0 [scalar] or None</span>
<span class="sd">        Used for setting the Mel frequency scales</span>

<span class="sd">    tuning : float</span>
<span class="sd">        Tuning deviation from A440, in fractions of a bin.</span>

<span class="sd">        This is used for CQT frequency scales, so that ``fmin`` is adjusted</span>
<span class="sd">        to ``fmin * 2**(tuning / bins_per_octave)``.</span>

<span class="sd">    bins_per_octave : int &gt; 0 [scalar]</span>
<span class="sd">        Number of bins per octave.  Used for CQT frequency scale.</span>

<span class="sd">    key : str</span>
<span class="sd">        The reference key to use when using note axes (`cqt_note`, `chroma`).</span>

<span class="sd">    Sa : float or int</span>
<span class="sd">        If using Hindustani or Carnatic svara axis decorations, specify Sa.</span>

<span class="sd">        For `cqt_svara`, ``Sa`` should be specified as a frequency in Hz.</span>

<span class="sd">        For `chroma_c` or `chroma_h`, ``Sa`` should correspond to the position</span>
<span class="sd">        of Sa within the chromagram.</span>
<span class="sd">        If not provided, Sa will default to 0 (equivalent to `C`)</span>

<span class="sd">    mela : str or int, optional</span>
<span class="sd">        If using `chroma_c` or `cqt_svara` display mode, specify the melakarta raga.</span>

<span class="sd">    thaat : str, optional</span>
<span class="sd">        If using `chroma_h` display mode, specify the parent thaat.</span>

<span class="sd">    auto_aspect : bool</span>
<span class="sd">        Axes will have &#39;equal&#39; aspect if the horizontal and vertical dimensions</span>
<span class="sd">        cover the same extent and their types match.</span>

<span class="sd">        To override, set to `False`.</span>

<span class="sd">    htk : bool</span>
<span class="sd">        If plotting on a mel frequency axis, specify which version of the mel</span>
<span class="sd">        scale to use.</span>

<span class="sd">            - `False`: use Slaney formula (default)</span>
<span class="sd">            - `True`: use HTK formula</span>

<span class="sd">        See `core.mel_frequencies` for more information.</span>

<span class="sd">    unicode : bool</span>
<span class="sd">        If using note or svara decorations, setting `unicode=True`</span>
<span class="sd">        will use unicode glyphs for accidentals and octave encoding.</span>

<span class="sd">        Setting `unicode=False` will use ASCII glyphs.  This can be helpful</span>
<span class="sd">        if your font does not support musical notation symbols.</span>

<span class="sd">    ax : matplotlib.axes.Axes or None</span>
<span class="sd">        Axes to plot on instead of the default `plt.gca()`.</span>

<span class="sd">    **kwargs : additional keyword arguments</span>
<span class="sd">        Arguments passed through to `matplotlib.pyplot.pcolormesh`.</span>

<span class="sd">        By default, the following options are set:</span>

<span class="sd">            - ``rasterized=True``</span>
<span class="sd">            - ``shading=&#39;auto&#39;``</span>
<span class="sd">            - ``edgecolors=&#39;None&#39;``</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    colormesh : `matplotlib.collections.QuadMesh`</span>
<span class="sd">        The color mesh object produced by `matplotlib.pyplot.pcolormesh`</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    cmap : Automatic colormap detection</span>
<span class="sd">    matplotlib.pyplot.pcolormesh</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Visualize an STFT power spectrum using default parameters</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; y, sr = librosa.load(librosa.ex(&#39;choice&#39;), duration=15)</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=2, ncols=1, sharex=True)</span>
<span class="sd">    &gt;&gt;&gt; D = librosa.amplitude_to_db(np.abs(librosa.stft(y)), ref=np.max)</span>
<span class="sd">    &gt;&gt;&gt; img = librosa.display.specshow(D, y_axis=&#39;linear&#39;, x_axis=&#39;time&#39;,</span>
<span class="sd">    ...                                sr=sr, ax=ax[0])</span>
<span class="sd">    &gt;&gt;&gt; ax[0].set(title=&#39;Linear-frequency power spectrogram&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].label_outer()</span>

<span class="sd">    Or on a logarithmic scale, and using a larger hop</span>

<span class="sd">    &gt;&gt;&gt; hop_length = 1024</span>
<span class="sd">    &gt;&gt;&gt; D = librosa.amplitude_to_db(np.abs(librosa.stft(y, hop_length=hop_length)),</span>
<span class="sd">    ...                             ref=np.max)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(D, y_axis=&#39;log&#39;, sr=sr, hop_length=hop_length,</span>
<span class="sd">    ...                          x_axis=&#39;time&#39;, ax=ax[1])</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(title=&#39;Log-frequency power spectrogram&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].label_outer()</span>
<span class="sd">    &gt;&gt;&gt; fig.colorbar(img, ax=ax, format=&quot;%+2.f dB&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Trying to display complex-valued input. &quot;</span> <span class="s2">&quot;Showing magnitude instead.&quot;</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;rasterized&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;edgecolors&quot;</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;shading&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">)</span>

    <span class="n">all_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
        <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span>
        <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
        <span class="n">tuning</span><span class="o">=</span><span class="n">tuning</span><span class="p">,</span>
        <span class="n">bins_per_octave</span><span class="o">=</span><span class="n">bins_per_octave</span><span class="p">,</span>
        <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">,</span>
        <span class="n">n_fft</span><span class="o">=</span><span class="n">n_fft</span><span class="p">,</span>
        <span class="n">win_length</span><span class="o">=</span><span class="n">win_length</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
        <span class="n">htk</span><span class="o">=</span><span class="n">htk</span><span class="p">,</span>
        <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Get the x and y coordinates</span>
    <span class="n">y_coords</span> <span class="o">=</span> <span class="n">__mesh_coords</span><span class="p">(</span><span class="n">y_axis</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">all_params</span><span class="p">)</span>
    <span class="n">x_coords</span> <span class="o">=</span> <span class="n">__mesh_coords</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">x_coords</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">all_params</span><span class="p">)</span>

    <span class="n">axes</span> <span class="o">=</span> <span class="n">__check_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">__set_current_image</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>

    <span class="c1"># Set up axis scaling</span>
    <span class="n">__scale_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">x_axis</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">__scale_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>

    <span class="c1"># Construct tickers and locators</span>
    <span class="n">__decorate_axis</span><span class="p">(</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">x_axis</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">Sa</span><span class="o">=</span><span class="n">Sa</span><span class="p">,</span> <span class="n">mela</span><span class="o">=</span><span class="n">mela</span><span class="p">,</span> <span class="n">thaat</span><span class="o">=</span><span class="n">thaat</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span>
    <span class="p">)</span>
    <span class="n">__decorate_axis</span><span class="p">(</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">Sa</span><span class="o">=</span><span class="n">Sa</span><span class="p">,</span> <span class="n">mela</span><span class="o">=</span><span class="n">mela</span><span class="p">,</span> <span class="n">thaat</span><span class="o">=</span><span class="n">thaat</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span>
    <span class="p">)</span>

    <span class="c1"># If the plot is a self-similarity/covariance etc. plot, square it</span>
    <span class="k">if</span> <span class="n">__same_axes</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span> <span class="n">axes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span> <span class="ow">and</span> <span class="n">auto_aspect</span><span class="p">:</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">out</span></div>


<span class="k">def</span> <span class="nf">__set_current_image</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper to set the current image in pyplot mode.</span>

<span class="sd">    If the provided ``ax`` is not `None`, then we assume that the user is using the object API.</span>
<span class="sd">    In this case, the pyplot current image is not set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">sci</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">__mesh_coords</span><span class="p">(</span><span class="n">ax_type</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute axis coordinates&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">coords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Coordinate shape mismatch: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span><span class="si">}</span><span class="s2">!=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> or </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">+1&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">coords</span>

    <span class="n">coord_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="n">__coord_fft_hz</span><span class="p">,</span>
        <span class="s2">&quot;fft&quot;</span><span class="p">:</span> <span class="n">__coord_fft_hz</span><span class="p">,</span>
        <span class="s2">&quot;fft_note&quot;</span><span class="p">:</span> <span class="n">__coord_fft_hz</span><span class="p">,</span>
        <span class="s2">&quot;fft_svara&quot;</span><span class="p">:</span> <span class="n">__coord_fft_hz</span><span class="p">,</span>
        <span class="s2">&quot;hz&quot;</span><span class="p">:</span> <span class="n">__coord_fft_hz</span><span class="p">,</span>
        <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="n">__coord_fft_hz</span><span class="p">,</span>
        <span class="s2">&quot;mel&quot;</span><span class="p">:</span> <span class="n">__coord_mel_hz</span><span class="p">,</span>
        <span class="s2">&quot;cqt&quot;</span><span class="p">:</span> <span class="n">__coord_cqt_hz</span><span class="p">,</span>
        <span class="s2">&quot;cqt_hz&quot;</span><span class="p">:</span> <span class="n">__coord_cqt_hz</span><span class="p">,</span>
        <span class="s2">&quot;cqt_note&quot;</span><span class="p">:</span> <span class="n">__coord_cqt_hz</span><span class="p">,</span>
        <span class="s2">&quot;cqt_svara&quot;</span><span class="p">:</span> <span class="n">__coord_cqt_hz</span><span class="p">,</span>
        <span class="s2">&quot;chroma&quot;</span><span class="p">:</span> <span class="n">__coord_chroma</span><span class="p">,</span>
        <span class="s2">&quot;chroma_c&quot;</span><span class="p">:</span> <span class="n">__coord_chroma</span><span class="p">,</span>
        <span class="s2">&quot;chroma_h&quot;</span><span class="p">:</span> <span class="n">__coord_chroma</span><span class="p">,</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">__coord_time</span><span class="p">,</span>
        <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="n">__coord_time</span><span class="p">,</span>
        <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="n">__coord_time</span><span class="p">,</span>
        <span class="s2">&quot;lag&quot;</span><span class="p">:</span> <span class="n">__coord_time</span><span class="p">,</span>
        <span class="s2">&quot;lag_s&quot;</span><span class="p">:</span> <span class="n">__coord_time</span><span class="p">,</span>
        <span class="s2">&quot;lag_ms&quot;</span><span class="p">:</span> <span class="n">__coord_time</span><span class="p">,</span>
        <span class="s2">&quot;tonnetz&quot;</span><span class="p">:</span> <span class="n">__coord_n</span><span class="p">,</span>
        <span class="s2">&quot;off&quot;</span><span class="p">:</span> <span class="n">__coord_n</span><span class="p">,</span>
        <span class="s2">&quot;tempo&quot;</span><span class="p">:</span> <span class="n">__coord_tempo</span><span class="p">,</span>
        <span class="s2">&quot;fourier_tempo&quot;</span><span class="p">:</span> <span class="n">__coord_fourier_tempo</span><span class="p">,</span>
        <span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="n">__coord_n</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">:</span> <span class="n">__coord_n</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">ax_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coord_map</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;Unknown axis type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ax_type</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">coord_map</span><span class="p">[</span><span class="n">ax_type</span><span class="p">](</span><span class="n">n</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">__check_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if &quot;axes&quot; is an instance of an axis object. If not, use `gca`.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">Axes</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span>
            <span class="s2">&quot;`axes` must be an instance of matplotlib.axes.Axes. &quot;</span>
            <span class="s2">&quot;Found type(axes)=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">axes</span>


<span class="k">def</span> <span class="nf">__scale_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">ax_type</span><span class="p">,</span> <span class="n">which</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the axis scaling&quot;&quot;&quot;</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version_parse</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version_parse</span><span class="p">(</span><span class="s2">&quot;3.3.0&quot;</span><span class="p">):</span>
            <span class="n">thresh</span> <span class="o">=</span> <span class="s2">&quot;linthreshx&quot;</span>
            <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;basex&quot;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="s2">&quot;linscalex&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thresh</span> <span class="o">=</span> <span class="s2">&quot;linthresh&quot;</span>
            <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;base&quot;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="s2">&quot;linscale&quot;</span>

        <span class="n">scaler</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">set_xscale</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">version_parse</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version_parse</span><span class="p">(</span><span class="s2">&quot;3.3.0&quot;</span><span class="p">):</span>
            <span class="n">thresh</span> <span class="o">=</span> <span class="s2">&quot;linthreshy&quot;</span>
            <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;basey&quot;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="s2">&quot;linscaley&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thresh</span> <span class="o">=</span> <span class="s2">&quot;linthresh&quot;</span>
            <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;base&quot;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="s2">&quot;linscale&quot;</span>

        <span class="n">scaler</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">set_yscale</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span>

    <span class="c1"># Map ticker scales</span>
    <span class="k">if</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;mel&quot;</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;symlog&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="n">thresh</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1000.0</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="n">base</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cqt&quot;</span><span class="p">,</span> <span class="s2">&quot;cqt_hz&quot;</span><span class="p">,</span> <span class="s2">&quot;cqt_note&quot;</span><span class="p">,</span> <span class="s2">&quot;cqt_svara&quot;</span><span class="p">]:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;log&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="n">base</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="s2">&quot;fft_note&quot;</span><span class="p">,</span> <span class="s2">&quot;fft_svara&quot;</span><span class="p">]:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;symlog&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="n">base</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="n">thresh</span><span class="p">]</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">note_to_hz</span><span class="p">(</span><span class="s2">&quot;C2&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="n">scale</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tempo&quot;</span><span class="p">,</span> <span class="s2">&quot;fourier_tempo&quot;</span><span class="p">]:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;log&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="n">base</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">limit</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">480</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">scaler</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">__decorate_axis</span><span class="p">(</span>
    <span class="n">axis</span><span class="p">,</span> <span class="n">ax_type</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;C:maj&quot;</span><span class="p">,</span> <span class="n">Sa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mela</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">thaat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Configure axis tickers, locators, and labels&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;tonnetz&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">TonnetzFormatter</span><span class="p">())</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Tonnetz&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;chroma&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ChromaFormatter</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">))</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">key_to_degrees</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span>
            <span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">degrees</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Pitch class&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;chroma_h&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Sa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Sa</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ChromaSvaraFormatter</span><span class="p">(</span><span class="n">Sa</span><span class="o">=</span><span class="n">Sa</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">thaat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If no thaat is given, show all svara</span>
            <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">degrees</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">thaat_to_degrees</span><span class="p">(</span><span class="n">thaat</span><span class="p">)</span>
        <span class="c1"># Rotate degrees relative to Sa</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">degrees</span> <span class="o">+</span> <span class="n">Sa</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span>
            <span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">degrees</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Svara&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;chroma_c&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Sa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Sa</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
            <span class="n">ChromaSvaraFormatter</span><span class="p">(</span><span class="n">Sa</span><span class="o">=</span><span class="n">Sa</span><span class="p">,</span> <span class="n">mela</span><span class="o">=</span><span class="n">mela</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">mela_to_degrees</span><span class="p">(</span><span class="n">mela</span><span class="p">)</span>
        <span class="c1"># Rotate degrees relative to Sa</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">degrees</span> <span class="o">+</span> <span class="n">Sa</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span>
            <span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">degrees</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Svara&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tempo&quot;</span><span class="p">,</span> <span class="s2">&quot;fourier_tempo&quot;</span><span class="p">]:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;BPM&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">TimeFormatter</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">prune</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">TimeFormatter</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">prune</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;ms&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">TimeFormatter</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">prune</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Time (ms)&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;lag&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">TimeFormatter</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">prune</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Lag&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;lag_s&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">TimeFormatter</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">prune</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Lag (s)&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;lag_ms&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">TimeFormatter</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">prune</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Lag (ms)&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;cqt_note&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">NoteFormatter</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">))</span>
        <span class="c1"># Where is C1 relative to 2**k hz?</span>
        <span class="n">log_C1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">note_to_hz</span><span class="p">(</span><span class="s2">&quot;C1&quot;</span><span class="p">))</span>
        <span class="n">C_offset</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">log_C1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">log_C1</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">(</span><span class="n">C_offset</span><span class="p">,)))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">NoteFormatter</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">major</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span>
            <span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="n">C_offset</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Note&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;cqt_svara&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">SvaraFormatter</span><span class="p">(</span><span class="n">Sa</span><span class="o">=</span><span class="n">Sa</span><span class="p">,</span> <span class="n">mela</span><span class="o">=</span><span class="n">mela</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">))</span>
        <span class="c1"># Find the offset of Sa relative to 2**k Hz</span>
        <span class="n">sa_offset</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">Sa</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">Sa</span><span class="p">)))</span>

        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">(</span><span class="n">sa_offset</span><span class="p">,)))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span>
            <span class="n">SvaraFormatter</span><span class="p">(</span><span class="n">Sa</span><span class="o">=</span><span class="n">Sa</span><span class="p">,</span> <span class="n">mela</span><span class="o">=</span><span class="n">mela</span><span class="p">,</span> <span class="n">major</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span>
            <span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="n">sa_offset</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Svara&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cqt_hz&quot;</span><span class="p">]:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">LogHzFormatter</span><span class="p">())</span>
        <span class="n">log_C1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">note_to_hz</span><span class="p">(</span><span class="s2">&quot;C1&quot;</span><span class="p">))</span>
        <span class="n">C_offset</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">log_C1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">log_C1</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">(</span><span class="n">C_offset</span><span class="p">,)))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">LogHzFormatter</span><span class="p">(</span><span class="n">major</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span>
            <span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="n">C_offset</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Hz&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;fft_note&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">NoteFormatter</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">))</span>
        <span class="c1"># Where is C1 relative to 2**k hz?</span>
        <span class="n">log_C1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">note_to_hz</span><span class="p">(</span><span class="s2">&quot;C1&quot;</span><span class="p">))</span>
        <span class="n">C_offset</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">log_C1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">log_C1</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">SymmetricalLogLocator</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">NoteFormatter</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">major</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span>
            <span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Note&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="o">==</span> <span class="s2">&quot;fft_svara&quot;</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">SvaraFormatter</span><span class="p">(</span><span class="n">Sa</span><span class="o">=</span><span class="n">Sa</span><span class="p">,</span> <span class="n">mela</span><span class="o">=</span><span class="n">mela</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">))</span>
        <span class="c1"># Find the offset of Sa relative to 2**k Hz</span>
        <span class="n">log_Sa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">Sa</span><span class="p">)</span>
        <span class="n">sa_offset</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">log_Sa</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">log_Sa</span><span class="p">))</span>

        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span>
            <span class="n">SymmetricalLogLocator</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(),</span> <span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">[</span><span class="n">sa_offset</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span>
            <span class="n">SvaraFormatter</span><span class="p">(</span><span class="n">Sa</span><span class="o">=</span><span class="n">Sa</span><span class="p">,</span> <span class="n">mela</span><span class="o">=</span><span class="n">mela</span><span class="p">,</span> <span class="n">major</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unicode</span><span class="o">=</span><span class="n">unicode</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span>
            <span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="n">sa_offset</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Svara&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mel&quot;</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">]:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">SymmetricalLogLocator</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()))</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Hz&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;hz&quot;</span><span class="p">,</span> <span class="s2">&quot;fft&quot;</span><span class="p">]:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Hz&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;frames&quot;</span><span class="p">]:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Frames&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ax_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;off&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;Unsupported axis type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ax_type</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">__coord_fft_hz</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the frequencies for FFT bins&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_fft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_fft</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># The following code centers the FFT bins at their frequencies</span>
    <span class="c1"># and clips to the non-negative frequency range [0, nyquist]</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">fft_frequencies</span><span class="p">(</span><span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="n">n_fft</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">basis</span>


<span class="k">def</span> <span class="nf">__coord_mel_hz</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span> <span class="n">htk</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the frequencies for Mel bins&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">fmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">fmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sr</span>

    <span class="n">basis</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">mel_frequencies</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span> <span class="n">htk</span><span class="o">=</span><span class="n">htk</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">basis</span>


<span class="k">def</span> <span class="nf">__coord_cqt_hz</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bins_per_octave</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get CQT bin frequencies&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">note_to_hz</span><span class="p">(</span><span class="s2">&quot;C1&quot;</span><span class="p">)</span>

    <span class="c1"># Apply tuning correction</span>
    <span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tuning&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">)</span>

    <span class="c1"># we drop by half a bin so that CQT bins are centered vertically</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">cqt_frequencies</span><span class="p">(</span>
        <span class="n">n</span><span class="p">,</span>
        <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span>
        <span class="n">bins_per_octave</span><span class="o">=</span><span class="n">bins_per_octave</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">freqs</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sr</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Frequency axis exceeds Nyquist. &quot;</span>
            <span class="s2">&quot;Did you remember to set all spectrogram parameters in specshow?&quot;</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">freqs</span>


<span class="k">def</span> <span class="nf">__coord_chroma</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">bins_per_octave</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get chroma bin numbers&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mf">12.0</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins_per_octave</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">__coord_tempo</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tempo coordinates&quot;&quot;&quot;</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">tempo_frequencies</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">basis</span>


<span class="k">def</span> <span class="nf">__coord_fourier_tempo</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">win_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fourier tempogram coordinates&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">win_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">win_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># The following code centers the FFT bins at their frequencies</span>
    <span class="c1"># and clips to the non-negative frequency range [0, nyquist]</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">fourier_tempo_frequencies</span><span class="p">(</span>
        <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">,</span> <span class="n">win_length</span><span class="o">=</span><span class="n">win_length</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">basis</span>


<span class="k">def</span> <span class="nf">__coord_n</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get bare positions&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">__coord_time</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get time coordinates from frames&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">frames_to_time</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">__same_axes</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if two axes are the same, used to determine squared plots&quot;&quot;&quot;</span>
    <span class="n">axes_same_and_not_none</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_axis</span> <span class="o">==</span> <span class="n">y_axis</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">axes_same_lim</span> <span class="o">=</span> <span class="n">xlim</span> <span class="o">==</span> <span class="n">ylim</span>
    <span class="k">return</span> <span class="n">axes_same_and_not_none</span> <span class="ow">and</span> <span class="n">axes_same_lim</span>


<div class="viewcode-block" id="waveshow"><a class="viewcode-back" href="../../generated/librosa.display.waveshow.html#librosa.display.waveshow">[docs]</a><span class="k">def</span> <span class="nf">waveshow</span><span class="p">(</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">sr</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span>
    <span class="n">max_points</span><span class="o">=</span><span class="mi">11025</span><span class="p">,</span>
    <span class="n">x_axis</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
    <span class="n">offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">where</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Visualize a waveform in the time domain.</span>

<span class="sd">    This function constructs a plot which adaptively switches between a raw</span>
<span class="sd">    samples-based view of the signal (`matplotlib.pyplot.step`) and an</span>
<span class="sd">    amplitude-envelope view of the signal (`matplotlib.pyplot.fill_between`)</span>
<span class="sd">    depending on the time extent of the plot&#39;s viewport.</span>

<span class="sd">    More specifically, when the plot spans a time interval of less than ``max_points /</span>
<span class="sd">    sr`` (by default, 1/2 second), the samples-based view is used, and otherwise a</span>
<span class="sd">    downsampled amplitude envelope is used.</span>
<span class="sd">    This is done to limit the complexity of the visual elements to guarantee an</span>
<span class="sd">    efficient, visually interpretable plot.</span>

<span class="sd">    When using interactive rendering (e.g., in a Jupyter notebook or IPython</span>
<span class="sd">    console), the plot will automatically update as the view-port is changed, either</span>
<span class="sd">    through widget controls or programmatic updates.</span>

<span class="sd">    .. note:: When visualizing stereo waveforms, the amplitude envelope will be generated</span>
<span class="sd">        so that the upper limits derive from the left channel, and the lower limits derive</span>
<span class="sd">        from the right channel, which can produce a vertically asymmetric plot.</span>

<span class="sd">        When zoomed in to the sample view, only the first channel will be shown.</span>
<span class="sd">        If you want to visualize both channels at the sample level, it is recommended to</span>
<span class="sd">        plot each signal independently.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : np.ndarray [shape=(n,) or (2,n)]</span>
<span class="sd">        audio time series (mono or stereo)</span>

<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        sampling rate of ``y`` (samples per second)</span>

<span class="sd">    max_points : positive integer</span>
<span class="sd">        Maximum number of samples to draw.  When the plot covers a time extent</span>
<span class="sd">        smaller than ``max_points / sr`` (default: 1/2 second), samples are drawn.</span>

<span class="sd">        If drawing raw samples would exceed `max_points`, then a downsampled</span>
<span class="sd">        amplitude envelope extracted from non-overlapping windows of `y` is</span>
<span class="sd">        visualized instead.  The parameters of the amplitude envelope are defined so</span>
<span class="sd">        that the resulting plot cannot produce more than `max_points` frames.</span>

<span class="sd">    x_axis : str or None</span>
<span class="sd">        Display of the x-axis ticks and tick markers. Accepted values are:</span>

<span class="sd">        - &#39;time&#39; : markers are shown as milliseconds, seconds, minutes, or hours.</span>
<span class="sd">                    Values are plotted in units of seconds.</span>

<span class="sd">        - &#39;s&#39; : markers are shown as seconds.</span>

<span class="sd">        - &#39;ms&#39; : markers are shown as milliseconds.</span>

<span class="sd">        - &#39;lag&#39; : like time, but past the halfway point counts as negative values.</span>

<span class="sd">        - &#39;lag_s&#39; : same as lag, but in seconds.</span>

<span class="sd">        - &#39;lag_ms&#39; : same as lag, but in milliseconds.</span>

<span class="sd">        - `None`, &#39;none&#39;, or &#39;off&#39;: ticks and tick markers are hidden.</span>

<span class="sd">    ax : matplotlib.axes.Axes or None</span>
<span class="sd">        Axes to plot on instead of the default `plt.gca()`.</span>

<span class="sd">    offset : float</span>
<span class="sd">        Horizontal offset (in seconds) to start the waveform plot</span>

<span class="sd">    marker : string</span>
<span class="sd">        Marker symbol to use for sample values. (default: no markers)</span>

<span class="sd">        See also: `matplotlib.markers`.</span>

<span class="sd">    where : string, {&#39;pre&#39;, &#39;mid&#39;, &#39;post&#39;}</span>
<span class="sd">        This setting determines how both waveform and envelope plots interpolate</span>
<span class="sd">        between observations.</span>

<span class="sd">        See `matplotlib.pyplot.step` for details.</span>

<span class="sd">        Default: &#39;post&#39;</span>

<span class="sd">    label : string [optional]</span>
<span class="sd">        The label string applied to this plot.</span>
<span class="sd">        Note that the label</span>

<span class="sd">    **kwargs</span>
<span class="sd">        Additional keyword arguments to `matplotlib.pyplot.fill_between` and</span>
<span class="sd">        `matplotlib.pyplot.step`.</span>

<span class="sd">        Note that only those arguments which are common to both functions will be</span>
<span class="sd">        supported.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    librosa.display.AdaptiveWaveplot</span>
<span class="sd">        An object of type `librosa.display.AdaptiveWaveplot`</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    AdaptiveWaveplot</span>
<span class="sd">    matplotlib.pyplot.step</span>
<span class="sd">    matplotlib.pyplot.fill_between</span>
<span class="sd">    matplotlib.markers</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Plot a monophonic waveform with an envelope view</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; y, sr = librosa.load(librosa.ex(&#39;choice&#39;), duration=10)</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=3, sharex=True)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.waveshow(y, sr=sr, ax=ax[0])</span>
<span class="sd">    &gt;&gt;&gt; ax[0].set(title=&#39;Envelope view, mono&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].label_outer()</span>

<span class="sd">    Or a stereo waveform</span>

<span class="sd">    &gt;&gt;&gt; y, sr = librosa.load(librosa.ex(&#39;choice&#39;, hq=True), mono=False, duration=10)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.waveshow(y, sr=sr, ax=ax[1])</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(title=&#39;Envelope view, stereo&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].label_outer()</span>

<span class="sd">    Or harmonic and percussive components with transparency</span>

<span class="sd">    &gt;&gt;&gt; y, sr = librosa.load(librosa.ex(&#39;choice&#39;), duration=10)</span>
<span class="sd">    &gt;&gt;&gt; y_harm, y_perc = librosa.effects.hpss(y)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.waveshow(y_harm, sr=sr, alpha=0.5, ax=ax[2], label=&#39;Harmonic&#39;)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.waveshow(y_perc, sr=sr, color=&#39;r&#39;, alpha=0.5, ax=ax[2], label=&#39;Percussive&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[2].set(title=&#39;Multiple waveforms&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[2].legend()</span>

<span class="sd">    Zooming in on a plot to show raw sample values</span>

<span class="sd">    &gt;&gt;&gt; fig, (ax, ax2) = plt.subplots(nrows=2, sharex=True)</span>
<span class="sd">    &gt;&gt;&gt; ax.set(xlim=[6.0, 6.01], title=&#39;Sample view&#39;, ylim=[-0.2, 0.2])</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.waveshow(y, sr=sr, ax=ax, marker=&#39;.&#39;, label=&#39;Full signal&#39;)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.waveshow(y_harm, sr=sr, alpha=0.5, ax=ax2, label=&#39;Harmonic&#39;)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.waveshow(y_perc, sr=sr, color=&#39;r&#39;, alpha=0.5, ax=ax2, label=&#39;Percussive&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax.label_outer()</span>
<span class="sd">    &gt;&gt;&gt; ax.legend()</span>
<span class="sd">    &gt;&gt;&gt; ax2.legend()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">util</span><span class="o">.</span><span class="n">valid_audio</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mono</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Pad an extra channel dimension, if necessary</span>
    <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">if</span> <span class="n">max_points</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span>
            <span class="s2">&quot;max_points=</span><span class="si">{}</span><span class="s2"> must be strictly positive&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_points</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Create the adaptive drawing object</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">__check_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;color&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">_get_lines</span><span class="o">.</span><span class="n">prop_cycler</span><span class="p">)[</span><span class="s2">&quot;color&quot;</span><span class="p">])</span>

    <span class="c1"># Reduce by envelope calculation</span>
    <span class="c1"># this choice of hop ensures that the envelope has at most max_points values</span>
    <span class="n">hop_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">max_points</span><span class="p">)</span>
    <span class="n">y_env</span> <span class="o">=</span> <span class="n">__envelope</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">hop_length</span><span class="p">)</span>

    <span class="c1"># Split the envelope into top and bottom</span>
    <span class="n">y_bottom</span><span class="p">,</span> <span class="n">y_top</span> <span class="o">=</span> <span class="o">-</span><span class="n">y_env</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_env</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">times</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">core</span><span class="o">.</span><span class="n">times_like</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Only plot up to max_points worth of data here</span>
    <span class="p">(</span><span class="n">steps</span><span class="p">,)</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>
        <span class="n">times</span><span class="p">[:</span><span class="n">max_points</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="n">max_points</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="n">envelope</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">times</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_top</span><span class="p">)</span> <span class="o">*</span> <span class="n">hop_length</span> <span class="p">:</span> <span class="n">hop_length</span><span class="p">],</span>
        <span class="n">y_bottom</span><span class="p">,</span>
        <span class="n">y_top</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="n">where</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">adaptor</span> <span class="o">=</span> <span class="n">AdaptiveWaveplot</span><span class="p">(</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">steps</span><span class="p">,</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="n">max_points</span>
    <span class="p">)</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;xlim_changed&quot;</span><span class="p">,</span> <span class="n">adaptor</span><span class="o">.</span><span class="n">update</span><span class="p">)</span>

    <span class="c1"># Force an initial update to ensure the state is consistent</span>
    <span class="n">adaptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

    <span class="c1"># Construct tickers and locators</span>
    <span class="n">__decorate_axis</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">x_axis</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">adaptor</span></div>
</pre></div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013--2022, librosa development team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  

<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: 0.9.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Releases</dt>
      <dd><a href="../../../0.7.2/index.html">0.7.2</a></dd>
      <dd><a href="../../../0.8.1/index.html">0.8.1</a></dd>
      <dd><a href="display.html">0.9.0</a></dd>
      <dd><a href="../../../0.9.1/index.html">0.9.1</a></dd>
    </dl>
    <dl>
      <dt>Development versions</dt>
      <dd><a href="../../../main/index.html">main</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-171031946-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-171031946-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>